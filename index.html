<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€€è´§æ‹†åŒ…è®°å½•ç³»ç»Ÿ</title>
    <style>
        /* åŸºç¡€æ ·å¼ - ä¿æŒä¸å˜ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans SC', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            min-height: 100vh;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }
        
        /* é¡¶éƒ¨æ ‡é¢˜æ  */
        .app-header {
            background: linear-gradient(135deg, #4a6ee0 0%, #6a8eff 100%);
            color: white;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(74, 110, 224, 0.2);
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .header-left i {
            font-size: 28px;
        }
        
        .header-left h1 {
            font-size: 22px;
            font-weight: 600;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .system-status {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 20px;
        }
        
        .status-indicator {
            width: 10px;
            height: 10px;
            background-color: #4cd964;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .current-time {
            font-family: monospace;
            font-size: 18px;
            font-weight: 500;
        }
        
        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            flex: 1;
            display: flex;
            padding: 20px;
            gap: 20px;
            overflow: hidden;
        }
        
        .left-panel, .right-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }
        
        .card h2 {
            font-size: 18px;
            margin-bottom: 20px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card h2 i {
            color: #4a6ee0;
        }
        
        /* æ‰«ç åŒºåŸŸ */
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-with-icon {
            position: relative;
            margin-bottom: 15px;
        }
        
        .input-with-icon i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }
        
        .input-with-icon input {
            width: 100%;
            padding: 15px 15px 15px 45px;
            border: 2px solid #e1e5eb;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .input-with-icon input:focus {
            border-color: #4a6ee0;
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 110, 224, 0.1);
        }
        
        .input-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4a6ee0 0%, #6a8eff 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 110, 224, 0.3);
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #495057;
            border: 1px solid #dee2e6;
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
        }
        
        .scan-hint {
            background: #f8f9ff;
            padding: 10px 15px;
            border-radius: 8px;
            color: #6c757d;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* è®¢å•ä¿¡æ¯ - ä¿®æ”¹åçš„æ ·å¼ */
        .order-details {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .detail-row {
            display: flex;
            align-items: flex-start;
            min-height: 40px;
        }
        
        .detail-label {
            width: 100px;
            color: #6c757d;
            font-weight: 500;
            line-height: 1.5;
        }
        
        .detail-value {
            flex: 1;
            font-weight: 500;
            line-height: 1.5;
            word-break: break-word;
        }
        
        .detail-value.highlight {
            color: #4a6ee0;
            font-weight: 600;
        }
        
        .status-pending {
            color: #ff9500;
            background: #fff4e6;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            display: inline-block;
        }
        
        .damage-tags {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .tag {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tag-good {
            background: #e7f5ff;
            color: #339af0;
            border: 1px solid #a5d8ff;
        }
        
        .tag-damaged {
            background: #fff5f5;
            color: #fa5252;
            border: 1px solid #ffc9c9;
        }
        
        .tag-missing {
            background: #fff9db;
            color: #fab005;
            border: 1px solid #ffec99;
        }
        
        .tag-other {
            background: #f8f9fa;
            color: #868e96;
            border: 1px solid #e9ecef;
        }
        
        .tag.active {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        #orderNotes {
            width: 100%;
            height: 80px;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            resize: vertical;
            font-family: inherit;
        }
        
        /* ç»Ÿè®¡ä¿¡æ¯ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .stat-item {
            background: #f8f9ff;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 1px solid #e9ecef;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #4a6ee0;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 14px;
        }
        
        /* ğŸ› ï¸ ä¿®å¤6ï¼šè§†é¢‘å½•åˆ¶åŒºåŸŸ - æ”¹ä¸ºæ­£æ–¹å½¢æ¯”ä¾‹ */
        .video-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .video-preview {
            position: relative;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            height: 400px; /* ğŸ› ï¸ ä¿®å¤ï¼šæ”¹ä¸ºå›ºå®šé«˜åº¦ */
            width: 400px;  /* ğŸ› ï¸ ä¿®å¤ï¼šæ·»åŠ å®½åº¦ï¼Œå½¢æˆæ­£æ–¹å½¢ */
            margin: 0 auto; /* å±…ä¸­æ˜¾ç¤º */
        }
        
        .no-camera {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #999;
            background: #1a1a1a;
        }
        
        .no-camera i {
            font-size: 60px;
            margin-bottom: 15px;
        }
        
        .video-controls {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .timer-display {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }
        
        .control-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn-record {
            background: linear-gradient(135deg, #ff4757 0%, #ff6b81 100%);
            color: white;
        }
        
        .btn-pause {
            background: #ffa502;
            color: white;
        }
        
        .btn-stop {
            background: #2ed573;
            color: white;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        .recording-status {
            flex: 1;
            text-align: right;
            color: #666;
            font-weight: 500;
        }
        
        /* è®¾ç½®åŒºåŸŸ */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .setting-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .setting-item label {
            color: #495057;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .setting-item input,
        .setting-item select {
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .path-display {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
            color: #666;
        }
        
        .setting-toggle {
            margin-top: 10px;
        }
        
        .toggle-switch {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .toggle-switch input {
            display: none;
        }
        
        .toggle-slider {
            width: 50px;
            height: 24px;
            background-color: #ccc;
            border-radius: 24px;
            position: relative;
            transition: all 0.3s;
            margin-right: 10px;
        }
        
        .toggle-slider:before {
            content: "";
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: white;
            top: 2px;
            left: 2px;
            transition: all 0.3s;
        }
        
        .toggle-switch input:checked + .toggle-slider {
            background-color: #4a6ee0;
        }
        
        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        /* æœ€è¿‘å½•åˆ¶åŒºåŸŸ */
        .recent-list {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #adb5bd;
        }
        
        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        /* åº•éƒ¨å¯¼èˆª */
        .app-footer {
            background: white;
            border-top: 1px solid #e9ecef;
            padding: 10px 20px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .footer-nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            background: white;
            color: #666;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid #e9ecef;
        }
        
        .nav-btn:hover {
            background: #f8f9ff;
            color: #4a6ee0;
            border-color: #4a6ee0;
            transform: translateY(-2px);
        }
        
        .nav-btn.active {
            background: #4a6ee0;
            color: white;
            border-color: #4a6ee0;
        }
        
        .nav-btn i {
            font-size: 16px;
        }
        
        /* é¡µé¢åˆ‡æ¢å®¹å™¨ */
        .page-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }
        
        .page-container.active {
            display: block;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .close-page {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 5px 15px;
        }
        
        .close-page:hover {
            color: #333;
        }
        
        .page-content {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* æ•°æ®åº“é¡µé¢é¢å¤–æ ·å¼ */
        .btn-warning {
            background: linear-gradient(135deg, #ff9500 0%, #ffcc00 100%);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #ff6b6b 100%);
            color: white;
        }
        
        .btn-warning:hover, .btn-success:hover, .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        /* æ•°æ®åº“é¡µé¢æ ·å¼ */
        .database-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 14px;
        }
        
        .database-table th,
        .database-table td {
            border: 1px solid #e1e5eb;
            padding: 12px 8px;
            text-align: left;
            vertical-align: middle;
        }
        
        .database-table th {
            background-color: #f8f9ff;
            font-weight: 600;
            color: #2c3e50;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .database-table tr:hover {
            background-color: #f8f9ff;
        }
        
        .database-table td {
            color: #495057;
        }
        
        .database-table .btn-sm {
            padding: 4px 8px;
            font-size: 12px;
            min-width: auto;
        }
        
        /* å¯¼å…¥åŒºåŸŸæ–°æ ·å¼ */
        .import-section {
            margin-top: 40px;
            padding: 25px;
            border: 1px solid #e1e5eb;
            border-radius: 12px;
            background-color: #f8f9ff;
        }
        
        .import-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .excel-import-card {
            background: white;
            border: 2px solid #e7f5ff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .excel-import-card h4 {
            color: #339af0;
            margin-bottom: 15px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .field-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
            padding: 15px;
            background: #f8f9ff;
            border-radius: 8px;
        }
        
        .field-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #495057;
        }
        
        .field-item i {
            color: #4a6ee0;
        }
        
        .import-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e1e5eb;
        }
        
        .file-info {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px 15px;
            background: #f8f9ff;
            border-radius: 6px;
            border: 1px solid #e1e5eb;
            min-width: 200px;
        }
        
        .file-info i {
            color: #28a745;
        }
        
        .strategy-select {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: #f8f9ff;
            border-radius: 6px;
            border: 1px solid #e1e5eb;
        }
        
        .strategy-select select {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            background: white;
            font-size: 14px;
            min-width: 180px;
        }
        
        /* è¿›åº¦æ¡æ ·å¼ */
        .import-progress {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e1e5eb;
            display: none;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .progress-bar-container {
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #4a6ee0, #6a8eff);
            transition: width 0.3s ease;
            border-radius: 10px;
        }
        
        .progress-details {
            display: flex;
            justify-content: space-between;
            color: #6c757d;
            font-size: 13px;
            margin-top: 5px;
        }
        
        /* ç»“æœå±•ç¤ºæ ·å¼ */
        .import-result {
            margin-top: 20px;
            display: none;
        }
        
        .result-card {
            padding: 20px;
            border-radius: 8px;
            border: 1px solid transparent;
        }
        
        .result-success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        
        .result-error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        .stats-grid-small {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 15px 0;
        }
        
        .stat-card-small {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e1e5eb;
        }
        
        .stat-value-small {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-label-small {
            font-size: 12px;
            color: #6c757d;
        }
        
        /* æ•°æ®æ¸…ç†åŒºåŸŸ */
        .cleanup-section {
            margin-top: 30px;
            padding: 20px;
            background: #fff5f5;
            border: 2px dashed #ffc9c9;
            border-radius: 10px;
        }
        
        .cleanup-section h4 {
            color: #fa5252;
            margin-bottom: 15px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .cleanup-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .cleanup-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: white;
            border-radius: 6px;
            border: 1px solid #ffc9c9;
        }
        
        .warning-text {
            color: #e8590c;
            font-size: 13px;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1024px) {
            .main-content {
                flex-direction: column;
            }
            
            .left-panel, .right-panel {
                width: 100%;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .import-controls {
                flex-direction: column;
                align-items: stretch;
            }
        }
        
        @media (max-width: 768px) {
            .app-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
                padding: 15px;
            }
            
            .header-right {
                width: 100%;
                justify-content: center;
            }
            
            .control-buttons {
                justify-content: center;
            }
            
            .video-controls {
                flex-direction: column;
            }
            
            .footer-nav {
                flex-direction: column;
            }
            
            .nav-btn {
                width: 100%;
                justify-content: center;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stats-grid-small {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .database-table th, 
            .database-table td {
                padding: 8px 6px;
                font-size: 13px;
            }
            
            /* ğŸ› ï¸ ä¿®å¤6ï¼šåœ¨ç§»åŠ¨ç«¯ä¿æŒæ­£æ–¹å½¢ä½†ç¨å° */
            .video-preview {
                height: 300px;
                width: 300px;
            }
        }
        
        /* æ–°æ¶ˆæ¯é€šçŸ¥æ ·å¼ */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 9999;
            animation: slideIn 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            max-width: 300px;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        .notification-success {
            background-color: #28a745;
        }
        
        .notification-error {
            background-color: #dc3545;
        }
        
        .notification-info {
            background-color: #17a2b8;
        }
        
        .notification-warning {
            background-color: #ffc107;
        }
        
        .status-processed {
            color: #28a745;
            background: #e6fcf5;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            display: inline-block;
        }
        
        .status-returned {
            color: #868e96;
            background: #f8f9fa;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            display: inline-block;
        }
        
        /* éšè—å…ƒç´  */
        .hidden {
            display: none !important;
        }
        
        /* æ–°å¢è®¢å•è¯¦æƒ…æ ·å¼ */
        .order-detail-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }
        
        .order-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .order-detail-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .order-detail-body {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .order-detail-group {
            margin-bottom: 15px;
        }
        
        .order-detail-label {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .order-detail-value {
            font-size: 15px;
            color: #333;
            padding: 8px 12px;
            background: #f8f9ff;
            border-radius: 6px;
            border: 1px solid #e9ecef;
            word-break: break-all;
        }
        
        .sku-info-container {
            max-height: 150px;
            overflow-y: auto;
            padding: 10px;
            background: #f8f9ff;
            border-radius: 6px;
            border: 1px solid #e9ecef;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .damage-selection {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .damage-btn {
            padding: 8px 16px;
            border: 2px solid #e9ecef;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .damage-btn:hover {
            border-color: #4a6ee0;
        }
        
        .damage-btn.selected {
            background: #4a6ee0;
            color: white;
            border-color: #4a6ee0;
        }
        
        .damage-btn.good.selected {
            background: #28a745;
            border-color: #28a745;
        }
        
        .damage-btn.damaged.selected {
            background: #dc3545;
            border-color: #dc3545;
        }
        
        .damage-btn.missing.selected {
            background: #ffc107;
            border-color: #ffc107;
            color: #212529;
        }
        
        .damage-btn.other.selected {
            background: #6c757d;
            border-color: #6c757d;
        }
        
        .notes-textarea {
            width: 100%;
            height: 80px;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }
        
        .order-search-results {
            position: absolute;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            max-height: 300px;
            overflow-y: auto;
            z-index: 100;
            margin-top: 5px;
            width: 100%;
            display: none;
        }
        
        .search-result-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f8f9fa;
            transition: background 0.2s;
        }
        
        .search-result-item:hover {
            background: #f8f9ff;
        }
        
        .search-result-item:last-child {
            border-bottom: none;
        }
        
        .search-result-item .order-number {
            font-weight: 600;
            color: #4a6ee0;
        }
        
        .search-result-item .shop-name {
            font-size: 13px;
            color: #666;
            margin-top: 3px;
        }
        
        .search-result-item .express-number {
            font-size: 13px;
            color: #28a745;
            margin-top: 3px;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
        <header class="app-header">
            <div class="header-left">
                <i class="fas fa-box-open"></i>
                <h1>é€€è´§æ‹†åŒ…è®°å½•ç³»ç»Ÿ</h1>
            </div>
            <div class="header-right">
                <div class="system-status">
                    <span class="status-indicator online"></span>
                    <span class="status-text" id="statusText">ç³»ç»Ÿå°±ç»ª</span>
                </div>
                <div class="current-time" id="currentTime">--:--:--</div>
            </div>
        </header>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="main-content">
            <!-- å·¦ä¾§åŠŸèƒ½åŒº -->
            <div class="left-panel">
                <!-- æ‰«ç è¾“å…¥åŒºåŸŸ -->
                <div class="card scan-section">
                    <h2><i class="fas fa-barcode"></i> æ‰«ç å½•å…¥</h2>
                    <div class="input-group">
                        <div class="input-with-icon">
                            <i class="fas fa-qrcode"></i>
                            <input type="text" 
                                   id="orderInput" 
                                   placeholder="è¯·æ‰«æå¿«é€’å•å·ã€è®¢å•å·æˆ–æ‰‹åŠ¨è¾“å…¥"
                                   autocomplete="off"
                                   autocapitalize="off"
                                   autocorrect="off">
                            <div class="order-search-results" id="orderSearchResults"></div>
                        </div>
                        <div class="input-actions">
                            <button id="scanButton" class="btn btn-primary">
                                <i class="fas fa-camera"></i> æ‰«ç å½•å…¥
                            </button>
                            <button id="manualButton" class="btn btn-secondary">
                                <i class="fas fa-keyboard"></i> æ‰‹åŠ¨è¾“å…¥
                            </button>
                        </div>
                    </div>
                    <div class="scan-hint">
                        <i class="fas fa-lightbulb"></i> æç¤ºï¼šæ”¯æŒæ‰«ææˆ–è¾“å…¥è®¢å•å·ã€å‘è´§è¿å•å·ã€é€€è´§è¿å•å·
                    </div>
                </div>

                <!-- è®¢å•ä¿¡æ¯æ˜¾ç¤º - ä¿®æ”¹ä¸ºè¯¦æƒ…å¡ç‰‡ -->
                <div id="orderDetailCard" class="order-detail-card" style="display: none;">
                    <div class="order-detail-header">
                        <h2 class="order-detail-title"><i class="fas fa-clipboard-list"></i> è®¢å•è¯¦æƒ…</h2>
                        <button id="closeOrderDetail" class="btn btn-secondary btn-sm">
                            <i class="fas fa-times"></i> å…³é—­
                        </button>
                    </div>
                    
                    <div class="order-detail-body">
                        <div class="order-detail-group">
                            <div class="order-detail-label">è®¢å•ç¼–å·</div>
                            <div id="detailOrderNumber" class="order-detail-value highlight"></div>
                        </div>
                        
                        <div class="order-detail-group">
                            <div class="order-detail-label">åº—é“ºåç§°</div>
                            <div id="detailShopName" class="order-detail-value"></div>
                        </div>
                        
                        <div class="order-detail-group">
                            <div class="order-detail-label">å‘è´§è¿å•å·</div>
                            <div id="detailExpressNumber" class="order-detail-value"></div>
                        </div>
                        
                        <div class="order-detail-group">
                            <div class="order-detail-label">é€€è´§è¿å•å·</div>
                            <div id="detailTrackingNumber" class="order-detail-value"></div>
                        </div>
                        
                        <div class="order-detail-group" style="grid-column: span 2;">
                            <div class="order-detail-label">SKUä¿¡æ¯</div>
                            <div id="detailSkuInfo" class="sku-info-container"></div>
                        </div>
                        
                        <div class="order-detail-group" style="grid-column: span 2;">
                            <div class="order-detail-label">æŸåæƒ…å†µ</div>
                            <div class="damage-selection">
                                <button class="damage-btn good" data-damage="å®Œå¥½">å®Œå¥½</button>
                                <button class="damage-btn damaged" data-damage="ç ´æŸ">ç ´æŸ</button>
                                <button class="damage-btn missing" data-damage="ç¼ºä»¶">ç¼ºä»¶</button>
                                <button class="damage-btn other" data-damage="å…¶ä»–">å…¶ä»–</button>
                            </div>
                        </div>
                        
                        <div class="order-detail-group" style="grid-column: span 2;">
                            <div class="order-detail-label">å¤‡æ³¨</div>
                            <textarea id="detailOrderNotes" class="notes-textarea" placeholder="æ·»åŠ å¤‡æ³¨..."></textarea>
                            <button id="saveOrderNotes" class="btn btn-primary btn-sm" style="margin-top: 10px;">
                                <i class="fas fa-save"></i> ä¿å­˜å¤‡æ³¨
                            </button>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button id="startVideoRecording" class="btn btn-danger">
                            <i class="fas fa-video"></i> å¼€å§‹å½•åˆ¶
                        </button>
                        <button id="stopVideoRecording" class="btn btn-secondary" disabled>
                            <i class="fas fa-stop"></i> åœæ­¢å½•åˆ¶
                        </button>
                    </div>
                </div>

                <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                <div class="card stats-section">
                    <h2><i class="fas fa-chart-bar"></i> ä»Šæ—¥ç»Ÿè®¡</h2>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="todayTotal">0</div>
                            <div class="stat-label">æ€»è®¢å•</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="todayProcessed">0</div>
                            <div class="stat-label">å·²å¤„ç†</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="todayDamaged">0</div>
                            <div class="stat-label">æŸå</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="todayVideos">0</div>
                            <div class="stat-label">è§†é¢‘</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§å½•åˆ¶åŒºåŸŸ -->
            <div class="right-panel">
                <!-- è§†é¢‘é¢„è§ˆåŒºåŸŸ -->
                <div class="card video-section">
                    <h2><i class="fas fa-video"></i> è§†é¢‘å½•åˆ¶</h2>
                    <div class="video-container">
                        <div class="video-preview" id="videoPreview">
                            <div class="no-camera">
                                <i class="fas fa-video-slash"></i>
                                <p>æ‘„åƒå¤´æœªè¿æ¥</p>
                            </div>
                            <video id="cameraFeed" autoplay playsinline muted style="transform: scaleX(1);"></video>
                        </div>
                        <div class="video-controls">
                            <div class="timer-display">
                                <i class="fas fa-clock"></i>
                                <span id="recordingTimer">00:00</span>
                            </div>
                            <div class="control-buttons">
                                <button id="recordButton" class="btn btn-record" disabled>
                                    <i class="fas fa-circle"></i> å¼€å§‹å½•åˆ¶
                                </button>
                                <button id="pauseButton" class="btn btn-pause" disabled>
                                    <i class="fas fa-pause"></i> æš‚åœ
                                </button>
                                <button id="stopButton" class="btn btn-stop" disabled>
                                    <i class="fas fa-stop"></i> åœæ­¢
                                </button>
                                <button id="cameraButton" class="btn btn-secondary">
                                    <i class="fas fa-camera"></i> æ‹ç…§
                                </button>
                            </div>
                            <div class="recording-status">
                                <span id="recordingStatus">å‡†å¤‡å°±ç»ª</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å½•åˆ¶è®¾ç½® -->
                <div class="card settings-section">
                    <h2><i class="fas fa-cog"></i> å½•åˆ¶è®¾ç½®</h2>
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label for="recordingDuration">
                                <i class="fas fa-hourglass-half"></i> å½•åˆ¶æ—¶é•¿ï¼ˆç§’ï¼‰
                            </label>
                            <input type="number" id="recordingDuration" min="10" max="600" value="30">
                        </div>
                        <div class="setting-item">
                            <label for="videoQuality">
                                <i class="fas fa-hd"></i> è§†é¢‘è´¨é‡
                            </label>
                            <select id="videoQuality">
                                <option value="low">ä½è´¨é‡</option>
                                <option value="medium" selected>ä¸­ç­‰è´¨é‡</option>
                                <option value="high">é«˜è´¨é‡</option>
                                <option value="max">æœ€é«˜è´¨é‡</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label for="cameraSelect">
                                <i class="fas fa-camera"></i> é€‰æ‹©æ‘„åƒå¤´
                            </label>
                            <select id="cameraSelect">
                                <option value="">æ­£åœ¨æ£€æµ‹æ‘„åƒå¤´...</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label>
                                <i class="fas fa-folder"></i> ä¿å­˜è·¯å¾„
                            </label>
                            <div class="path-display">é€€è´§æ‹†åŒ…è§†é¢‘/</div>
                        </div>
                    </div>
                    <div class="setting-toggle">
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoStartRecording" checked>
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">æ‰«ç åè‡ªåŠ¨å¼€å§‹å½•åˆ¶</span>
                        </label>
                    </div>
                </div>

                <!-- æœ€è¿‘å½•åˆ¶è®°å½• -->
                <div class="card recent-section">
                    <h2><i class="fas fa-history"></i> æœ€è¿‘å½•åˆ¶</h2>
                    <div class="recent-list" id="recentList">
                        <div class="empty-state">
                            <i class="fas fa-film"></i>
                            <p>æš‚æ— å½•åˆ¶è®°å½•</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- åº•éƒ¨å¯¼èˆª -->
        <footer class="app-footer">
            <div class="footer-nav">
                <button class="nav-btn active" data-page="home">
                    <i class="fas fa-home"></i> ä¸»é¡µ
                </button>
                <button class="nav-btn" data-page="database">
                    <i class="fas fa-database"></i> æ•°æ®åº“
                </button>
                <button class="nav-btn" data-page="export">
                    <i class="fas fa-file-export"></i> å¯¼å‡º
                </button>
                <button class="nav-btn" data-page="settings">
                    <i class="fas fa-sliders-h"></i> è®¾ç½®
                </button>
                <button class="nav-btn" data-page="help">
                    <i class="fas fa-question-circle"></i> å¸®åŠ©
                </button>
            </div>
        </footer>
    </div>

    <!-- é¡µé¢åˆ‡æ¢å®¹å™¨ -->
    <div class="page-container" id="pageContainer">
        <!-- æ•°æ®åº“é¡µé¢ - ä¼˜åŒ–ç‰ˆ -->
        <div id="databasePage" class="page" style="display:none;">
            <div class="page-header">
                <h2><i class="fas fa-database"></i> æ•°æ®åº“ç®¡ç†</h2>
                <button class="close-page" data-page="home">Ã— å…³é—­</button>
            </div>
            <div class="page-content">
                <!-- æ•°æ®åº“æ§åˆ¶æŒ‰é’® -->
                <div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:20px;">
                    <button class="btn btn-primary" id="refreshDB">
                        <i class="fas fa-sync-alt"></i> åˆ·æ–°æ•°æ®
                    </button>
                    <button class="btn btn-secondary" id="searchDB">
                        <i class="fas fa-search"></i> æœç´¢
                    </button>
                    <button class="btn btn-danger" id="clearDB">
                        <i class="fas fa-trash"></i> æ¸…ç©ºæ•°æ®
                    </button>
                </div>
                
                <!-- æœç´¢å’Œè¿‡æ»¤åŒºåŸŸ -->
                <div style="margin:20px 0; padding:15px; background:#f8f9ff; border-radius:8px;">
                    <div style="display:flex; gap:15px; align-items:center; flex-wrap:wrap;">
                        <div>
                            <label style="margin-right:10px;"><i class="fas fa-calendar"></i> æ—¥æœŸèŒƒå›´:</label>
                            <input type="date" id="filterDateFrom" style="padding:8px; border:1px solid #ddd; border-radius:4px;">
                            <span style="margin:0 10px;">è‡³</span>
                            <input type="date" id="filterDateTo" style="padding:8px; border:1px solid #ddd; border-radius:4px;">
                        </div>
                        
                        <div>
                            <label style="margin-right:10px;"><i class="fas fa-tag"></i> çŠ¶æ€:</label>
                            <select id="filterStatus" style="padding:8px; border:1px solid #ddd; border-radius:4px;">
                                <option value="">å…¨éƒ¨</option>
                                <option value="å¾…å¤„ç†">å¾…å¤„ç†</option>
                                <option value="å·²å¤„ç†">å·²å¤„ç†</option>
                                <option value="å·²é€€å›">å·²é€€å›</option>
                            </select>
                        </div>
                        
                        <div>
                            <label style="margin-right:10px;"><i class="fas fa-exclamation-triangle"></i> æŸåæƒ…å†µ:</label>
                            <select id="filterDamage" style="padding:8px; border:1px solid #ddd; border-radius:4px;">
                                <option value="">å…¨éƒ¨</option>
                                <option value="å®Œå¥½">å®Œå¥½</option>
                                <option value="ç ´æŸ">ç ´æŸ</option>
                                <option value="ç¼ºä»¶">ç¼ºä»¶</option>
                                <option value="å…¶ä»–">å…¶ä»–</option>
                            </select>
                        </div>
                        
                        <button class="btn btn-primary" id="applyFilter">
                            <i class="fas fa-filter"></i> åº”ç”¨ç­›é€‰
                        </button>
                        <button class="btn btn-secondary" id="resetFilter">
                            <i class="fas fa-redo"></i> é‡ç½®
                        </button>
                    </div>
                </div>
                
                <!-- æ•°æ®ç»Ÿè®¡æ‘˜è¦ -->
                <div style="display:flex; gap:15px; margin-bottom:20px; flex-wrap:wrap;">
                    <div class="stat-card" style="flex:1; min-width:120px; background:#e7f5ff; padding:15px; border-radius:8px; text-align:center;">
                        <div style="font-size:24px; font-weight:bold; color:#339af0;" id="totalRecords">0</div>
                        <div style="color:#666;">æ€»è®°å½•æ•°</div>
                    </div>
                    <div class="stat-card" style="flex:1; min-width:120px; background:#fff5f5; padding:15px; border-radius:8px; text-align:center;">
                        <div style="font-size:24px; font-weight:bold; color:#fa5252;" id="damagedRecords">0</div>
                        <div style="color:#666;">æŸåè®°å½•</div>
                    </div>
                    <div class="stat-card" style="flex:1; min-width:120px; background:#fff9db; padding:15px; border-radius:8px; text-align:center;">
                        <div style="font-size:24px; font-weight:bold; color:#fab005;" id="pendingRecords">0</div>
                        <div style="color:#666;">å¾…å¤„ç†</div>
                    </div>
                    <div class="stat-card" style="flex:1; min-width:120px; background:#e6fcf5; padding:15px; border-radius:8px; text-align:center;">
                        <div style="font-size:24px; font-weight:bold; color:#20c997;" id="processedRecords">0</div>
                        <div style="color:#666;">å·²å¤„ç†</div>
                    </div>
                </div>
                
                <!-- æ•°æ®åº“è¡¨æ ¼ -->
                <div class="database-table-container">
                    <table class="database-table">
                        <thead>
                            <tr>
                                <th style="width:50px;">
                                    <input type="checkbox" id="selectAll">
                                </th>
                                <th style="width:150px;">è®¢å•å·</th>
                                <th style="width:120px;">åº—é“ºåç§°</th>
                                <th style="width:180px;">æ‰«ææ—¶é—´</th>
                                <th style="width:100px;">çŠ¶æ€</th>
                                <th style="width:100px;">æŸåæƒ…å†µ</th>
                                <th style="width:150px;">è§†é¢‘æ–‡ä»¶</th>
                                <th style="min-width:200px;">å¤‡æ³¨</th>
                                <th style="width:120px;">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="databaseTableBody">
                            <tr>
                                <td colspan="9" style="text-align:center;padding:40px;">
                                    <i class="fas fa-database" style="font-size:48px;color:#ddd;margin-bottom:10px;"></i>
                                    <p>æš‚æ— æ•°æ®</p>
                                    <p style="color:#999;font-size:14px;margin-top:10px;">ç‚¹å‡»ä¸‹æ–¹"å¯¼å…¥Excelæ•°æ®"æŒ‰é’®å¯¼å…¥æ•°æ®</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- åˆ†é¡µæ§åˆ¶ -->
                <div class="pagination-controls" style="display:flex; justify-content:space-between; align-items:center; margin-top:20px; padding-top:15px; border-top:1px solid #eee;">
                    <div class="page-info" style="color:#666;">
                        æ˜¾ç¤º <span id="currentPage">1</span>/<span id="totalPages">1</span> é¡µ, 
                        å…± <span id="totalItems">0</span> æ¡è®°å½•
                    </div>
                    <div class="pagination-buttons" style="display:flex; gap:5px;">
                        <button class="btn btn-secondary" id="firstPage" disabled>
                            <i class="fas fa-angle-double-left"></i>
                        </button>
                        <button class="btn btn-secondary" id="prevPage" disabled>
                            <i class="fas fa-angle-left"></i>
                        </button>
                        <button class="btn btn-secondary" id="nextPage" disabled>
                            <i class="fas fa-angle-right"></i>
                        </button>
                        <button class="btn btn-secondary" id="lastPage" disabled>
                            <i class="fas fa-angle-double-right"></i>
                        </button>
                    </div>
                    <div class="page-size" style="display:flex; align-items:center; gap:10px;">
                        <span style="color:#666;">æ¯é¡µæ˜¾ç¤º:</span>
                        <select id="pageSize" style="padding:6px; border:1px solid #ddd; border-radius:4px;">
                            <option value="10">10æ¡</option>
                            <option value="20" selected>20æ¡</option>
                            <option value="50">50æ¡</option>
                            <option value="100">100æ¡</option>
                        </select>
                    </div>
                </div>
                
                <!-- =============== æ•°æ®å¯¼å…¥åŒºåŸŸ =============== -->
                <div class="import-section">
                    <h3><i class="fas fa-file-import"></i> Excelæ•°æ®å¯¼å…¥</h3>
                    
                    <!-- Excelå¯¼å…¥å¡ç‰‡ -->
                    <div class="excel-import-card">
                        <h4><i class="fas fa-file-excel"></i> æ”¯æŒExcel 25åˆ—å”®åè¡¨æ ¼å¯¼å…¥</h4>
                        <p style="color:#666; margin-bottom:15px;">ç³»ç»Ÿä¼šè‡ªåŠ¨ä»æ‚¨çš„å”®åè¡¨æ ¼ä¸­æå–6ä¸ªå…³é”®å­—æ®µï¼š</p>
                        
                        <div class="field-list">
                            <div class="field-item">
                                <i class="fas fa-hashtag"></i>
                                <span>è®¢å•ç¼–å·ï¼ˆä¸»é”®ï¼‰</span>
                            </div>
                            <div class="field-item">
                                <i class="fas fa-shipping-fast"></i>
                                <span>å‘è´§è¿å•å·ï¼ˆæ‰«ç ç”¨ï¼‰</span>
                            </div>
                            <div class="field-item">
                                <i class="fas fa-truck"></i>
                                <span>é€€è´§è¿å•å·ï¼ˆé€€è´§è¿½è¸ªï¼‰</span>
                            </div>
                            <div class="field-item">
                                <i class="fas fa-barcode"></i>
                                <span>SKUä¿¡æ¯ï¼ˆå•†å“è§„æ ¼ï¼‰</span>
                            </div>
                            <div class="field-item">
                                <i class="fas fa-sticky-note"></i>
                                <span>å¤‡æ³¨ï¼ˆé™„åŠ ä¿¡æ¯ï¼‰</span>
                            </div>
                            <div class="field-item">
                                <i class="fas fa-store"></i>
                                <span>åº—é“ºåå­—ï¼ˆåº—é“ºæ ‡è¯†ï¼‰</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å¯¼å…¥æ§åˆ¶åŒº -->
                    <div class="import-controls">
                        <!-- æ–‡ä»¶é€‰æ‹© -->
                        <div>
                            <input type="file" id="excelFileInput" accept=".xlsx,.xls,.csv" style="display:none;">
                            <button class="btn btn-primary" id="selectExcelFileBtn">
                                <i class="fas fa-file-excel"></i> é€‰æ‹©Excelæ–‡ä»¶
                            </button>
                        </div>
                        
                        <!-- æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤º -->
                        <div class="file-info">
                            <i class="fas fa-file"></i>
                            <span id="excelFileName">æœªé€‰æ‹©æ–‡ä»¶</span>
                            <span id="fileSize" style="color:#999; font-size:12px;"></span>
                        </div>
                        
                        <!-- åˆå¹¶ç­–ç•¥é€‰æ‹© -->
                        <div class="strategy-select">
                            <label style="white-space:nowrap;">åˆå¹¶ç­–ç•¥:</label>
                            <select id="mergeStrategy">
                                <option value="fill_blanks">æ™ºèƒ½åˆå¹¶ï¼ˆåªå¡«ç©ºç™½å­—æ®µï¼‰</option>
                                <option value="update_all">è¦†ç›–æ‰€æœ‰å­—æ®µ</option>
                                <option value="skip_duplicates">è·³è¿‡é‡å¤è®°å½•</option>
                            </select>
                        </div>
                        
                        <!-- å¼€å§‹å¯¼å…¥æŒ‰é’® -->
                        <button class="btn btn-success" id="startExcelImportBtn" disabled>
                            <i class="fas fa-upload"></i> å¼€å§‹å¯¼å…¥
                        </button>
                    </div>
                    
                    <!-- å¯¼å…¥è¿›åº¦æ˜¾ç¤º -->
                    <div class="import-progress" id="importProgress">
                        <div class="progress-header">
                            <span>å¯¼å…¥è¿›åº¦</span>
                            <span id="progressPercent">0%</span>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" id="progressBar"></div>
                        </div>
                        <div class="progress-details">
                            <span id="progressStatus">å‡†å¤‡å¯¼å…¥...</span>
                            <span id="progressCount">0/0</span>
                        </div>
                    </div>
                    
                    <!-- å¯¼å…¥ç»“æœå±•ç¤º -->
                    <div class="import-result" id="importResult">
                        <div id="resultMessage" class="result-card">
                            <!-- ç»“æœå†…å®¹ä¼šåŠ¨æ€æ’å…¥ -->
                        </div>
                    </div>
                </div>
                
                <!-- æ•°æ®å¤‡ä»½åŒºåŸŸ -->
                <div style="margin-top:30px; padding:15px; border:1px dashed #ddd; border-radius:8px;">
                    <h4><i class="fas fa-save"></i> æ•°æ®å¤‡ä»½</h4>
                    <div style="display:flex; gap:10px; margin-top:10px;">
                        <button class="btn btn-secondary" id="backupData">
                            <i class="fas fa-download"></i> å¤‡ä»½æ•°æ®åº“
                        </button>
                        <button class="btn btn-secondary" id="restoreData">
                            <i class="fas fa-upload"></i> æ¢å¤å¤‡ä»½
                        </button>
                        <div style="flex:1; text-align:right; color:#666; font-size:14px;">
                            æœ€åå¤‡ä»½: <span id="lastBackupTime">ä»æœªå¤‡ä»½</span>
                        </div>
                    </div>
                </div>
                
                <!-- =============== æ•°æ®æ¸…ç†åŒºåŸŸ =============== -->
                <div class="cleanup-section">
                    <h4><i class="fas fa-trash-alt"></i> æ•°æ®æ¸…ç†</h4>
                    <p style="color:#666;">æ¸…ç†è¶…è¿‡æŒ‡å®šå¤©æ•°çš„æ—§æ•°æ®ï¼Œé‡Šæ”¾å­˜å‚¨ç©ºé—´</p>
                    
                    <div class="cleanup-controls">
                        <div class="cleanup-option">
                            <label for="cleanupDays">æ¸…ç†è¶…è¿‡ï¼š</label>
                            <input type="number" id="cleanupDays" min="1" max="365" value="7" style="width:60px; padding:8px; border:1px solid #ddd; border-radius:4px;">
                            <span>å¤©çš„æ•°æ®</span>
                        </div>
                        
                        <div class="cleanup-option">
                            <label class="toggle-switch" style="cursor:pointer;">
                                <input type="checkbox" id="includeVideos">
                                <span class="toggle-slider"></span>
                                <span>åŒæ—¶æ¸…ç†è§†é¢‘æ–‡ä»¶</span>
                            </label>
                        </div>
                        
                        <button class="btn btn-danger" id="startCleanupBtn">
                            <i class="fas fa-broom"></i> å¼€å§‹æ¸…ç†
                        </button>
                    </div>
                    
                    <div class="warning-text">
                        <i class="fas fa-exclamation-triangle"></i>
                        æ³¨æ„ï¼šæ¸…ç†æ“ä½œä¸å¯æ’¤é”€ï¼Œå»ºè®®å…ˆå¤‡ä»½é‡è¦æ•°æ®ï¼
                    </div>
                    
                    <!-- æ¸…ç†ç»“æœå±•ç¤º -->
                    <div id="cleanupResult" style="margin-top:15px; display:none;">
                        <div id="cleanupResultMessage"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å…¶ä»–é¡µé¢ï¼ˆæš‚æ—¶ä¿æŒä¸å˜ï¼‰ -->
        <div id="exportPage" class="page" style="display:none;">
            <div class="page-header">
                <h2><i class="fas fa-file-export"></i> æ•°æ®å¯¼å‡º</h2>
                <button class="close-page" data-page="home">Ã— å…³é—­</button>
            </div>
            <div class="page-content">
                <p>æ•°æ®å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...</p>
            </div>
        </div>
        
        <div id="settingsPage" class="page" style="display:none;">
            <div class="page-header">
                <h2><i class="fas fa-sliders-h"></i> ç³»ç»Ÿè®¾ç½®</h2>
                <button class="close-page" data-page="home">Ã— å…³é—­</button>
            </div>
            <div class="page-content">
                <p>ç³»ç»Ÿè®¾ç½®åŠŸèƒ½å¼€å‘ä¸­...</p>
            </div>
        </div>
        
        <div id="helpPage" class="page" style="display:none;">
            <div class="page-header">
                <h2><i class="fas fa-question-circle"></i> å¸®åŠ©æ–‡æ¡£</h2>
                <button class="close-page" data-page="home">Ã— å…³é—­</button>
            </div>
            <div class="page-content">
                <p>å¸®åŠ©æ–‡æ¡£å¼€å‘ä¸­...</p>
            </div>
        </div>
    </div>

    <!-- éŸ³æ•ˆå…ƒç´  -->
    <audio id="beepSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-reward-952.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="successSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="errorSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3" type="audio/mpeg">
    </audio>

    <!-- å¤–éƒ¨åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>

    <!-- ============================================ -->
    <!-- æ–°çš„æ¨¡å—åŠ è½½ç³»ç»Ÿï¼ˆä¿®å¤ç‰ˆï¼‰ - ä»…æ›¿æ¢æ¨¡å—åŠ è½½éƒ¨åˆ† -->
    <!-- ============================================ -->
    
    <!-- å…¨å±€å‘½åç©ºé—´ -->
    <script>
        // å…¨å±€å‘½åç©ºé—´ - ç¡®ä¿åœ¨æ‰€æœ‰è„šæœ¬ä¹‹å‰å®šä¹‰
        window.ReturnUnpackSystem = window.ReturnUnpackSystem || {
            modules: {},
            events: {},
            initialized: false,
            initQueue: [],
            
            // åˆå§‹åŒ–çŠ¶æ€
            status: {
                loaded: {},
                initialized: {},
                errors: {}
            },
            
            // ğŸ› ï¸ ä¿®å¤ï¼šæ·»åŠ å½•åˆ¶é…ç½®ç®¡ç†
            recordingConfig: {
                duration: 30,
                quality: 'medium',
                autoStart: true,
                cameraId: null,
                loadConfig: function() {
                    try {
                        const saved = localStorage.getItem('recordingConfig');
                        if (saved) {
                            const config = JSON.parse(saved);
                            this.duration = config.duration || 30;
                            this.quality = config.quality || 'medium';
                            this.autoStart = config.autoStart !== false;
                            this.cameraId = config.cameraId || null;
                            console.log('âœ… å½•åˆ¶é…ç½®å·²åŠ è½½:', config);
                        }
                    } catch (e) {
                        console.warn('âš ï¸ åŠ è½½å½•åˆ¶é…ç½®å¤±è´¥:', e);
                    }
                },
                saveConfig: function() {
                    try {
                        const config = {
                            duration: this.duration,
                            quality: this.quality,
                            autoStart: this.autoStart,
                            cameraId: this.cameraId,
                            savedAt: new Date().toISOString()
                        };
                        localStorage.setItem('recordingConfig', JSON.stringify(config));
                        console.log('âœ… å½•åˆ¶é…ç½®å·²ä¿å­˜:', config);
                    } catch (e) {
                        console.error('âŒ ä¿å­˜å½•åˆ¶é…ç½®å¤±è´¥:', e);
                    }
                },
                updateDuration: function(duration) {
                    this.duration = Math.max(10, Math.min(600, parseInt(duration) || 30));
                    this.saveConfig();
                    console.log(`â±ï¸ å½•åˆ¶æ—¶é•¿æ›´æ–°ä¸º: ${this.duration}ç§’`);
                },
                updateQuality: function(quality) {
                    this.quality = quality;
                    this.saveConfig();
                    console.log(`ğŸ¥ è§†é¢‘è´¨é‡æ›´æ–°ä¸º: ${quality}`);
                },
                updateAutoStart: function(autoStart) {
                    this.autoStart = autoStart;
                    this.saveConfig();
                    console.log(`âš¡ è‡ªåŠ¨å½•åˆ¶æ›´æ–°ä¸º: ${autoStart ? 'å¼€å¯' : 'å…³é—­'}`);
                },
                updateCameraId: function(cameraId) {
                    this.cameraId = cameraId;
                    this.saveConfig();
                    console.log(`ğŸ“· æ‘„åƒå¤´IDæ›´æ–°ä¸º: ${cameraId || 'é»˜è®¤'}`);
                }
            },
            
            // æ¨¡å—åŠ è½½å™¨
            loadModule: function(moduleName, modulePath, dependencies = []) {
                return new Promise((resolve, reject) => {
                    console.log(`ğŸ”„ å¼€å§‹åŠ è½½æ¨¡å—: ${moduleName}`);
                    
                    // æ£€æŸ¥æ˜¯å¦å·²åŠ è½½
                    if (window.ReturnUnpackSystem.modules[moduleName]) {
                        console.log(`âœ… ${moduleName} å·²åŠ è½½`);
                        resolve(window.ReturnUnpackSystem.modules[moduleName]);
                        return;
                    }
                    
                    // åˆ›å»ºscriptå…ƒç´ 
                    const script = document.createElement('script');
                    script.src = modulePath;
                    script.dataset.module = moduleName;
                    
                    script.onload = function() {
                        console.log(`âœ… æ¨¡å—åŠ è½½å®Œæˆ: ${moduleName}`);
                        setTimeout(() => {
                            const moduleInstance = window.ReturnUnpackSystem.modules[moduleName];
                            if (moduleInstance) {
                                resolve(moduleInstance);
                            } else {
                                console.warn(`âš ï¸ æ¨¡å— ${moduleName} æœªæ­£ç¡®å¯¼å‡º`);
                                resolve(null);
                            }
                        }, 100);
                    };
                    
                    script.onerror = function() {
                        console.error(`âŒ æ¨¡å—åŠ è½½å¤±è´¥: ${moduleName}`);
                        reject(new Error(`æ— æ³•åŠ è½½æ¨¡å—: ${moduleName}`));
                    };
                    
                    document.head.appendChild(script);
                });
            },
            
            // åˆå§‹åŒ–æ¨¡å—
            initModule: async function(moduleName, options = {}) {
                try {
                    console.log(`ğŸ”„ å¼€å§‹åˆå§‹åŒ–æ¨¡å—: ${moduleName}`);
                    
                    const module = window.ReturnUnpackSystem.modules[moduleName];
                    if (!module) {
                        throw new Error(`æ¨¡å— ${moduleName} æœªæ‰¾åˆ°`);
                    }
                    
                    // æ£€æŸ¥ä¾èµ–
                    const dependencies = {};
                    if (options.dependencies) {
                        for (const depName of options.dependencies) {
                            if (!window.ReturnUnpackSystem.modules[depName]) {
                                console.warn(`âš ï¸ ä¾èµ–æ¨¡å— ${depName} æœªåŠ è½½`);
                            } else {
                                dependencies[depName] = window.ReturnUnpackSystem.modules[depName];
                            }
                        }
                    }
                    
                    // è°ƒç”¨æ¨¡å—çš„initæ–¹æ³•ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                    if (typeof module.init === 'function') {
                        const initResult = await module.init(dependencies, options.callbacks);
                        console.log(`âœ… ${moduleName} åˆå§‹åŒ–å®Œæˆ`, initResult);
                        this.status.initialized[moduleName] = true;
                        return initResult;
                    } else {
                        console.log(`âœ… ${moduleName} æ— éœ€åˆå§‹åŒ–ï¼ˆæ— initæ–¹æ³•ï¼‰`);
                        this.status.initialized[moduleName] = true;
                        return { success: true };
                    }
                } catch (error) {
                    console.error(`âŒ ${moduleName} åˆå§‹åŒ–å¤±è´¥:`, error);
                    this.status.errors[moduleName] = error.message;
                    return { success: false, error: error.message };
                }
            },
            
            // æ‰¹é‡åˆå§‹åŒ–
            initAllModules: async function() {
                console.log('ğŸš€ å¼€å§‹åˆå§‹åŒ–æ‰€æœ‰æ¨¡å—...');
                
                // æ¨¡å—åˆå§‹åŒ–é¡ºåºï¼ˆä¾èµ–é¡ºåºï¼‰
                const initOrder = [
                    'utils',
                    'database', 
                    'scanner',
                    'recorder',
                    'exchange'
                ];
                
                for (const moduleName of initOrder) {
                    if (window.ReturnUnpackSystem.modules[moduleName]) {
                        try {
                            // ä¸ºæ¯ä¸ªæ¨¡å—é…ç½®ä¾èµ–
                            const deps = {
                                utils: [],
                                database: ['utils'],
                                scanner: ['utils', 'database'],
                                recorder: ['utils'],
                                exchange: ['utils', 'database']
                            };
                            
                            await this.initModule(moduleName, {
                                dependencies: deps[moduleName] || [],
                                callbacks: {
                                    onLog: (data) => {
                                        console.log(`[${moduleName}] ${data.message}`);
                                    }
                                }
                            });
                        } catch (error) {
                            console.error(`æ¨¡å— ${moduleName} åˆå§‹åŒ–å¤±è´¥:`, error);
                        }
                    }
                }
                
                this.initialized = true;
                console.log('ğŸ‰ æ‰€æœ‰æ¨¡å—åˆå§‹åŒ–å®Œæˆ');
                
                // è§¦å‘ç³»ç»Ÿå°±ç»ªäº‹ä»¶
                if (window.ReturnUnpackSystem.events.onSystemReady) {
                    window.ReturnUnpackSystem.events.onSystemReady();
                }
            },
            
            // ç³»ç»Ÿå°±ç»ªå›è°ƒ
            onReady: function(callback) {
                if (this.initialized) {
                    callback();
                } else {
                    this.events.onSystemReady = callback;
                }
            }
        };
        
        console.log('ğŸ”§ ReturnUnpackSystem å…¨å±€å‘½åç©ºé—´å·²åˆ›å»º');
    </script>

    <!-- ============================================ -->
    <!-- å¼‚æ­¥åŠ è½½æ‰€æœ‰æ¨¡å— -->
    <!-- ============================================ -->
    <script>
        (async function() {
            console.log('ğŸ“¦ å¼€å§‹åŠ è½½ç³»ç»Ÿæ¨¡å—...');
            
            try {
                // ğŸ› ï¸ ä¿®å¤ï¼šå…ˆåŠ è½½å½•åˆ¶é…ç½®
                window.ReturnUnpackSystem.recordingConfig.loadConfig();
                
                // 1. åŠ è½½Utilsæ¨¡å—
                await window.ReturnUnpackSystem.loadModule('utils', 'modules/utils.js');
                
                // 2. åŠ è½½Databaseæ¨¡å—
                await window.ReturnUnpackSystem.loadModule('database', 'modules/database.js');
                
                // 3. åŠ è½½Scanneræ¨¡å—
                await window.ReturnUnpackSystem.loadModule('scanner', 'modules/scanner.js');
                
                // 4. åŠ è½½Recorderæ¨¡å—
                await window.ReturnUnpackSystem.loadModule('recorder', 'modules/recorder.js');
                
                // 5. åŠ è½½Exchangeæ¨¡å—ï¼ˆæ•°æ®äº¤æ¢æ¨¡å—ï¼‰
                await window.ReturnUnpackSystem.loadModule('exchange', 'modules/exchange.js');
                
                console.log('âœ… æ‰€æœ‰æ¨¡å—åŠ è½½å®Œæˆ');
                
                // åˆå§‹åŒ–æ‰€æœ‰æ¨¡å—
                await window.ReturnUnpackSystem.initAllModules();
                
                // åˆå§‹åŒ–ä¸»åº”ç”¨
                setTimeout(initializeApplication, 500);
                
            } catch (error) {
                console.error('âŒ ç³»ç»Ÿæ¨¡å—åŠ è½½å¤±è´¥:', error);
                showError('ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥: ' + error.message);
            }
        })();
        
        // é”™è¯¯æ˜¾ç¤ºå‡½æ•°
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                background: #ff4757;
                color: white;
                padding: 15px;
                text-align: center;
                font-weight: bold;
                z-index: 99999;
            `;
            errorDiv.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
            document.body.appendChild(errorDiv);
        }
    </script>

    <!-- ============================================ -->
    <!-- ğŸ”§ ä¿®å¤ç‰ˆï¼šä¸»åº”ç”¨ç¨‹åºè„šæœ¬ï¼ˆå®Œæ•´ä¿®å¤ï¼‰ -->
    <!-- ============================================ -->
    <script>
        // å…¨å±€å˜é‡
        let currentStream = null;
        let currentPage = 'home';
        let currentOrder = null;
        let searchTimer = null;
        let isRecording = false;
        let recordingTimerInterval = null;
        let recordingSeconds = 0;
        let downloadInProgress = false; // é˜²æ­¢é‡å¤ä¸‹è½½
        let videoProcessingLock = false; // è§†é¢‘å¤„ç†é”
        let recordingDuration = 30; // ğŸ› ï¸ ä¿®å¤ï¼šå­˜å‚¨å½•åˆ¶æ—¶é•¿
        
        // ğŸ› ï¸ ä¿®å¤ï¼šè¾…åŠ©å‡½æ•° - Blobè½¬Base64
        async function blobToBase64(blob) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(blob);
            });
        }
        
        // ğŸ› ï¸ ä¿®å¤ï¼šå¼ºåŒ–æŸåæƒ…å†µä¿å­˜å‡½æ•°
        async function saveDamageStatusOnly(damageStatus, notes = '') {
            if (!currentOrder || !currentOrder.orderNumber) {
                showMessage('è¯·å…ˆé€‰æ‹©è®¢å•', 'warning');
                return false;
            }
            
            try {
                if (!window.ReturnUnpackSystem || !window.ReturnUnpackSystem.modules.database) {
                    showMessage('æ•°æ®åº“æ¨¡å—æœªåˆå§‹åŒ–', 'error');
                    return false;
                }
                
                console.log(`ğŸ”„ ä¿å­˜æŸåçŠ¶æ€: ${damageStatus} åˆ°è®¢å• ${currentOrder.orderNumber}`);
                
                // ğŸ› ï¸ ä¿®å¤ï¼šä»æ•°æ®åº“è·å–å®Œæ•´çš„è®¢å•æ•°æ®
                const orderResult = await window.ReturnUnpackSystem.modules.database.getOrder(currentOrder.orderNumber);
                
                // ğŸ› ï¸ ä¿®å¤ï¼šæ­£ç¡®å¤„ç†è¿”å›å€¼æ ¼å¼
                if (!orderResult || !orderResult.success || !orderResult.data) {
                    console.error('âŒ è·å–è®¢å•ä¿¡æ¯å¤±è´¥:', orderResult?.message || 'æœªçŸ¥é”™è¯¯');
                    showMessage(`è·å–è®¢å•ä¿¡æ¯å¤±è´¥: ${orderResult?.message || 'è®¢å•ä¸å­˜åœ¨'}`, 'error');
                    return false;
                }
                
                const existingOrder = orderResult.data;
                console.log('ğŸ“‹ æ•°æ®åº“ä¸­åŸæœ‰è®¢å•æ•°æ®:', existingOrder);
                
                // ğŸ› ï¸ ä¿®å¤ï¼šä¿ç•™æ‰€æœ‰åŸå§‹å­—æ®µï¼Œåªæ›´æ–°æŸåæƒ…å†µ
                const updates = {
                    ...existingOrder, // ä¿ç•™æ‰€æœ‰å­—æ®µ
                    damage: damageStatus,
                    damageType: damageStatus,
                    notes: notes || existingOrder.notes || '',
                    updatedAt: new Date().toISOString(),
                    // ğŸ› ï¸ ç‰¹åˆ«ä¿æŠ¤é‡è¦å­—æ®µ
                    shopName: existingOrder.shopName || currentOrder.shopName || '',
                    orderNumber: existingOrder.orderNumber || currentOrder.orderNumber,
                    skuInfo: existingOrder.skuInfo || currentOrder.skuInfo || '',
                    expressNumber: existingOrder.expressNumber || currentOrder.expressNumber || '',
                    trackingNumber: existingOrder.trackingNumber || currentOrder.trackingNumber || ''
                };
                
                console.log('ğŸ”„ æ›´æ–°åçš„è®¢å•æ•°æ®:', updates);
                
                const result = await window.ReturnUnpackSystem.modules.database.updateOrder(currentOrder.orderNumber, updates);
                
                if (result && result.success) {
                    // æ›´æ–°å½“å‰è®¢å•å¯¹è±¡
                    currentOrder = { ...currentOrder, ...updates };
                    
                    // æ›´æ–°æ˜¾ç¤º
                    updateOrderDetailDisplay();
                    
                    showMessage(`æŸåæƒ…å†µå·²ä¿å­˜ä¸º: ${damageStatus}`, 'success');
                    return true;
                } else {
                    showMessage('ä¿å­˜å¤±è´¥: æ•°æ®åº“è¿”å›é”™è¯¯', 'error');
                    return false;
                }
                
            } catch (error) {
                console.error('âŒ ä¿å­˜æŸåçŠ¶æ€å¤±è´¥:', error);
                showMessage('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
                return false;
            }
        }
        
        // ğŸ› ï¸ ä¿®å¤ï¼šå¼ºåŒ–ä¿å­˜è§†é¢‘åˆ°è®¢å•å‡½æ•°ï¼ˆå…¨å±€å¯ç”¨ï¼‰
        window.saveVideoToOrder = async function(orderNumber, videoBlob, videoInfo = {}) {
            console.log(`ğŸ”„ [saveVideoToOrder] ä¿å­˜è§†é¢‘åˆ°è®¢å• ${orderNumber}`);
            
            // é˜²é‡å¤æ£€æŸ¥
            if (videoProcessingLock) {
                console.log('âš ï¸ è§†é¢‘å¤„ç†ä¸­ï¼Œè·³è¿‡é‡å¤è¯·æ±‚');
                return false;
            }
            
            videoProcessingLock = true;
            
            try {
                // ğŸ› ï¸ ä¿®å¤ï¼šæ£€æŸ¥è®¢å•å·æ˜¯å¦æœ‰æ•ˆ
                if (!orderNumber || typeof orderNumber !== 'string' || orderNumber.trim() === '') {
                    console.error('âŒ [saveVideoToOrder] è®¢å•å·æ— æ•ˆ:', orderNumber);
                    showMessage('è®¢å•å·æ— æ•ˆï¼Œæ— æ³•ä¿å­˜è§†é¢‘', 'error');
                    return false;
                }
                
                const trimmedOrderNumber = orderNumber.trim();
                console.log(`ğŸ” [saveVideoToOrder] å¤„ç†è®¢å•: "${trimmedOrderNumber}"`);
                
                if (!window.ReturnUnpackSystem || !window.ReturnUnpackSystem.modules.database) {
                    console.error('âŒ æ•°æ®åº“æ¨¡å—æœªåˆå§‹åŒ–');
                    showMessage('æ•°æ®åº“æ¨¡å—æœªåˆå§‹åŒ–', 'error');
                    return false;
                }
                
                // ğŸ› ï¸ ä¿®å¤ï¼šä»æ•°æ®åº“è·å–å®Œæ•´çš„è®¢å•æ•°æ®
                console.log(`ğŸ” [saveVideoToOrder] æ­£åœ¨æŸ¥è¯¢è®¢å•: ${trimmedOrderNumber}`);
                const orderResult = await window.ReturnUnpackSystem.modules.database.getOrder(trimmedOrderNumber);
                
                // ğŸ› ï¸ ä¿®å¤ï¼šæ­£ç¡®å¤„ç†è¿”å›å€¼æ ¼å¼
                if (!orderResult || !orderResult.success || !orderResult.data) {
                    console.error('âŒ [saveVideoToOrder] è·å–è®¢å•ä¿¡æ¯å¤±è´¥:', orderResult?.message || 'æœªçŸ¥é”™è¯¯');
                    showMessage(`è·å–è®¢å•ä¿¡æ¯å¤±è´¥: ${orderResult?.message || 'è®¢å•ä¸å­˜åœ¨'}`, 'error');
                    return false;
                }
                
                const existingOrder = orderResult.data;
                const shopName = existingOrder.shopName || 'æœªçŸ¥åº—é“º';
                
                console.log('ğŸ“‹ [saveVideoToOrder] ä»æ•°æ®åº“è·å–è®¢å•æ•°æ®:', {
                    orderNumber: existingOrder.orderNumber,
                    shopName: existingOrder.shopName,
                    status: existingOrder.status,
                    damage: existingOrder.damage || existingOrder.damageType,
                    expressNumber: existingOrder.expressNumber,
                    trackingNumber: existingOrder.trackingNumber,
                    skuInfo: existingOrder.skuInfo ? 'å·²ä¿ç•™' : 'æ— '
                });
                console.log(`ğŸª [saveVideoToOrder] åº—é“ºåç§°: ${shopName}`);
                
                // æ¸…ç†åº—é“ºåï¼Œç¡®ä¿æ–‡ä»¶åå®‰å…¨
                const cleanShopName = shopName
                    .replace(/[<>:"/\\|?*]/g, '')
                    .replace(/\s+/g, '_')
                    .trim()
                    .substring(0, 50);
                
                const videoFileName = `${trimmedOrderNumber}_${cleanShopName}.mp4`;
                
                console.log(`ğŸ“ [saveVideoToOrder] ç”Ÿæˆè§†é¢‘æ–‡ä»¶å: ${videoFileName}`);
                
                // ğŸ› ï¸ å…³é”®ä¿®å¤ï¼šä¿ç•™æ‰€æœ‰åŸå§‹å­—æ®µï¼Œåªæ›´æ–°è§†é¢‘ç›¸å…³å­—æ®µå’ŒçŠ¶æ€
                const updates = {
                    ...existingOrder, // ä¿ç•™æ‰€æœ‰åŸå§‹å­—æ®µ
                    // è§†é¢‘ç›¸å…³å­—æ®µæ›´æ–°
                    videoData: videoInfo.blob ? await blobToBase64(videoInfo.blob) : null,
                    videoFile: videoFileName,
                    videoFileName: videoFileName,
                    videoRecorded: true,
                    videoDuration: videoInfo.duration || recordingSeconds,
                    videoSize: videoInfo.fileSize || videoBlob.size || 0,
                    videoMimeType: videoInfo.mimeType || 'video/mp4',
                    videoRecordedAt: new Date().toISOString(),
                    // çŠ¶æ€æ›´æ–°
                    status: 'å·²å¤„ç†', // ğŸ› ï¸ ç¡®ä¿æ›´æ–°çŠ¶æ€
                    processedAt: new Date().toISOString(), // ğŸ› ï¸ æ·»åŠ å¤„ç†æ—¶é—´
                    updatedAt: new Date().toISOString()
                };
                
                console.log('ğŸ”„ [saveVideoToOrder] æ›´æ–°è®¢å•æ•°æ®:', {
                    orderNumber: updates.orderNumber,
                    shopName: updates.shopName,
                    status: updates.status,
                    videoFile: updates.videoFile,
                    skuInfo: updates.skuInfo ? 'å·²ä¿ç•™' : 'æ— ',
                    expressNumber: updates.expressNumber ? 'å·²ä¿ç•™' : 'æ— ',
                    trackingNumber: updates.trackingNumber ? 'å·²ä¿ç•™' : 'æ— ',
                    damageStatus: updates.damage || updates.damageType || 'å®Œå¥½'
                });
                
                // æ›´æ–°è®¢å•
                console.log(`ğŸ’¾ [saveVideoToOrder] æ­£åœ¨æ›´æ–°æ•°æ®åº“...`);
                const updateResult = await window.ReturnUnpackSystem.modules.database.updateOrder(trimmedOrderNumber, updates);
                
                if (updateResult && updateResult.success) {
                    console.log('âœ… [saveVideoToOrder] è§†é¢‘å’ŒçŠ¶æ€ä¿å­˜æˆåŠŸ');
                    
                    // æ›´æ–°å½“å‰è®¢å•å¯¹è±¡
                    if (currentOrder && currentOrder.orderNumber === trimmedOrderNumber) {
                        currentOrder = { ...currentOrder, ...updates };
                        updateOrderDetailDisplay();
                    }
                    
                    // æ·»åŠ åˆ°æœ€è¿‘å½•åˆ¶åˆ—è¡¨
                    addToRecentList(trimmedOrderNumber, videoFileName);
                    
                    // ğŸ› ï¸ ä¿®å¤ï¼šé˜²æ­¢é‡å¤ä¸‹è½½
                    if (!downloadInProgress) {
                        downloadInProgress = true;
                        try {
                            // ä¸‹è½½è§†é¢‘æ–‡ä»¶
                            console.log(`ğŸ“¥ [saveVideoToOrder] ä¸‹è½½è§†é¢‘æ–‡ä»¶: ${videoFileName}`);
                            downloadVideoFile(videoBlob, videoFileName);
                        } catch (downloadError) {
                            console.error('âŒ [saveVideoToOrder] ä¸‹è½½è§†é¢‘å¤±è´¥:', downloadError);
                        } finally {
                            setTimeout(() => {
                                downloadInProgress = false;
                            }, 1000);
                        }
                    } else {
                        console.log('âš ï¸ [saveVideoToOrder] ä¸‹è½½å·²åœ¨å¤„ç†ä¸­ï¼Œè·³è¿‡é‡å¤ä¸‹è½½');
                    }
                    
                    // æ›´æ–°ä»Šæ—¥ç»Ÿè®¡
                    updateTodayStats();
                    
                    showMessage('è§†é¢‘ä¿å­˜æˆåŠŸï¼Œè®¢å•çŠ¶æ€å·²æ›´æ–°ä¸º"å·²å¤„ç†"', 'success');
                    return true;
                } else {
                    console.error('âŒ [saveVideoToOrder] è§†é¢‘ä¿å­˜å¤±è´¥: æ•°æ®åº“æ›´æ–°è¿”å›é”™è¯¯');
                    showMessage('è§†é¢‘ä¿å­˜å¤±è´¥: æ•°æ®åº“é”™è¯¯', 'error');
                    return false;
                }
            } catch (error) {
                console.error('âŒ [saveVideoToOrder] ä¿å­˜è§†é¢‘åˆ°è®¢å•å¤±è´¥:', error);
                showMessage(`ä¿å­˜è§†é¢‘å¤±è´¥: ${error.message}`, 'error');
                return false;
            } finally {
                videoProcessingLock = false;
            }
        }
        
        // ğŸ› ï¸ ä¿®å¤ï¼šå¼ºåŒ–æŸåæ ‡ç­¾ç‚¹å‡»äº‹ä»¶å¤„ç†
        function setupDamageTags() {
            document.querySelectorAll('.damage-btn').forEach(btn => {
                btn.addEventListener('click', async function() {
                    const damageStatus = this.getAttribute('data-damage');
                    const notes = document.getElementById('detailOrderNotes').value;
                    
                    // ç§»é™¤å…¶ä»–æŒ‰é’®çš„é€‰ä¸­çŠ¶æ€
                    document.querySelectorAll('.damage-btn').forEach(b => {
                        b.classList.remove('selected');
                    });
                    
                    // è®¾ç½®å½“å‰æŒ‰é’®ä¸ºé€‰ä¸­çŠ¶æ€
                    this.classList.add('selected');
                    
                    // ä¿å­˜æŸåæƒ…å†µåˆ°æ•°æ®åº“
                    await saveDamageStatusOnly(damageStatus, notes);
                });
            });
        }
        
        // ç­‰å¾…ç³»ç»Ÿæ¨¡å—åˆå§‹åŒ–å®Œæˆ
        window.ReturnUnpackSystem.onReady(function() {
            console.log('ğŸ ç³»ç»Ÿæ¨¡å—å°±ç»ªï¼Œå¼€å§‹åˆå§‹åŒ–åº”ç”¨...');
            initializeApplication();
        });
        
        // å¦‚æœç³»ç»Ÿå·²ç»åˆå§‹åŒ–ï¼Œç›´æ¥å¯åŠ¨
        if (window.ReturnUnpackSystem.initialized) {
            console.log('ğŸ ç³»ç»Ÿå·²åˆå§‹åŒ–ï¼Œç›´æ¥å¯åŠ¨åº”ç”¨');
            setTimeout(initializeApplication, 500);
        }
        
        function initializeApplication() {
            console.log('ğŸš€ å¼€å§‹åˆå§‹åŒ–åº”ç”¨ç¨‹åº...');
            
            try {
                // æ£€æŸ¥æ ¸å¿ƒæ¨¡å—
                const requiredModules = ['utils', 'database', 'exchange', 'recorder'];
                const missingModules = requiredModules.filter(
                    module => !window.ReturnUnpackSystem.modules[module]
                );
                
                if (missingModules.length > 0) {
                    console.warn('âš ï¸ ç¼ºå°‘æ¨¡å—:', missingModules);
                    showMessage(`è­¦å‘Š: ç¼ºå°‘æ¨¡å— ${missingModules.join(', ')}`, 'warning');
                }
                
                // ğŸ› ï¸ ä¿®å¤ï¼šåˆå§‹åŒ–å½•åˆ¶é…ç½®
                initRecordingConfig();
                
                // åˆå§‹åŒ–æ—¶é—´æ˜¾ç¤º
                updateTime();
                setInterval(updateTime, 1000);
                
                // åˆå§‹åŒ–æ‘„åƒå¤´
                initCamera();
                
                // è®¾ç½®é¡µé¢å¯¼èˆª
                setupPageNavigation();
                
                // è®¾ç½®æ•°æ®åº“é¡µé¢äº‹ä»¶
                setupDatabasePage();
                
                // è®¾ç½®æ‰«ç è¾“å…¥äº‹ä»¶ï¼ˆä¿®æ”¹ä¸ºæ™ºèƒ½æŸ¥è¯¢ï¼‰
                setupSmartScanInput();
                
                // ğŸ› ï¸ ä¿®å¤ï¼šå¼ºåŒ–æŸåæ ‡ç­¾ç‚¹å‡»äº‹ä»¶
                setupDamageTags();
                
                // ğŸ› ï¸ ä¿®å¤ï¼šå¼ºåŒ–å½•åˆ¶æŒ‰é’®äº‹ä»¶
                setupRecordingButtons();
                
                // è®¾ç½®è®¢å•è¯¦æƒ…äº‹ä»¶
                setupOrderDetailEvents();
                
                // åŠ è½½ä»Šæ—¥ç»Ÿè®¡
                updateTodayStats();
                
                // è®¾ç½®å½•åˆ¶æ¨¡å—äº‹ä»¶ç›‘å¬
                setupRecorderEventListeners();
                
                console.log('âœ… ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
                showMessage('ç³»ç»Ÿå°±ç»ª', 'success');
                
            } catch (error) {
                console.error('âŒ åº”ç”¨åˆå§‹åŒ–å¤±è´¥:', error);
                showMessage(`åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // ğŸ› ï¸ ä¿®å¤ï¼šåˆå§‹åŒ–å½•åˆ¶é…ç½®
        function initRecordingConfig() {
            // åŠ è½½é…ç½®åˆ°UI
            const config = window.ReturnUnpackSystem.recordingConfig;
            recordingDuration = config.duration;
            
            const durationInput = document.getElementById('recordingDuration');
            const qualitySelect = document.getElementById('videoQuality');
            const autoStartCheckbox = document.getElementById('autoStartRecording');
            
            if (durationInput) {
                durationInput.value = config.duration;
                // ğŸ› ï¸ ä¿®å¤ï¼šæ·»åŠ å½•åˆ¶æ—¶é•¿å˜åŒ–äº‹ä»¶
                durationInput.addEventListener('change', function() {
                    const newDuration = parseInt(this.value);
                    if (!isNaN(newDuration) && newDuration >= 10 && newDuration <= 600) {
                        config.updateDuration(newDuration);
                        recordingDuration = newDuration;
                        console.log(`â±ï¸ å½•åˆ¶æ—¶é•¿è®¾ç½®ä¸º: ${newDuration}ç§’`);
                        showMessage(`å½•åˆ¶æ—¶é•¿å·²è®¾ç½®ä¸º ${newDuration}ç§’`, 'info');
                    } else {
                        this.value = config.duration;
                        showMessage('å½•åˆ¶æ—¶é•¿å¿…é¡»åœ¨10-600ç§’ä¹‹é—´', 'error');
                    }
                });
                
                durationInput.addEventListener('input', function() {
                    const newDuration = parseInt(this.value);
                    if (!isNaN(newDuration) && newDuration >= 10 && newDuration <= 600) {
                        config.updateDuration(newDuration);
                        recordingDuration = newDuration;
                    }
                });
            }
            
            if (qualitySelect) {
                qualitySelect.value = config.quality;
                // ğŸ› ï¸ ä¿®å¤ï¼šæ·»åŠ è§†é¢‘è´¨é‡å˜åŒ–äº‹ä»¶
                qualitySelect.addEventListener('change', function() {
                    config.updateQuality(this.value);
                    console.log(`ğŸ¥ è§†é¢‘è´¨é‡è®¾ç½®ä¸º: ${this.value}`);
                    showMessage(`è§†é¢‘è´¨é‡å·²è®¾ç½®ä¸º ${getQualityLabel(this.value)}`, 'info');
                    
                    // é‡æ–°å¯åŠ¨æ‘„åƒå¤´åº”ç”¨æ–°è´¨é‡è®¾ç½®
                    if (currentStream) {
                        const cameraSelect = document.getElementById('cameraSelect');
                        startCamera(cameraSelect ? cameraSelect.value : null);
                    }
                });
            }
            
            if (autoStartCheckbox) {
                autoStartCheckbox.checked = config.autoStart;
                autoStartCheckbox.addEventListener('change', function() {
                    config.updateAutoStart(this.checked);
                    console.log(`âš¡ è‡ªåŠ¨å½•åˆ¶è®¾ç½®ä¸º: ${this.checked ? 'å¼€å¯' : 'å…³é—­'}`);
                });
            }
        }
        
        // ğŸ› ï¸ ä¿®å¤ï¼šè·å–è´¨é‡æ ‡ç­¾
        function getQualityLabel(quality) {
            const labels = {
                'low': 'ä½è´¨é‡',
                'medium': 'ä¸­ç­‰è´¨é‡',
                'high': 'é«˜è´¨é‡',
                'max': 'æœ€é«˜è´¨é‡'
            };
            return labels[quality] || quality;
        }
        
        // è®¾ç½®å½•åˆ¶æ¨¡å—äº‹ä»¶ç›‘å¬
        function setupRecorderEventListeners() {
            const recorder = window.ReturnUnpackSystem.modules.recorder;
            if (!recorder) return;
            
            // ç›‘å¬å½•åˆ¶çŠ¶æ€å˜åŒ–
            recorder.onRecordingStarted = function(data) {
                console.log('ğŸ¬ å½•åˆ¶å¼€å§‹:', data);
                updateRecordingStatus('å½•åˆ¶ä¸­');
                startRecordingTimer();
                updateRecordingButtons(true);
            };
            
            recorder.onRecordingPaused = function() {
                console.log('â¸ï¸ å½•åˆ¶æš‚åœ');
                updateRecordingStatus('å½•åˆ¶æš‚åœ');
            };
            
            recorder.onRecordingResumed = function() {
                console.log('â–¶ï¸ å½•åˆ¶ç»§ç»­');
                updateRecordingStatus('å½•åˆ¶ä¸­');
            };
            
            recorder.onRecordingStopped = function(videoData) {
                console.log('â¹ï¸ å½•åˆ¶åœæ­¢:', videoData);
                updateRecordingStatus('å½•åˆ¶å®Œæˆ');
                stopRecordingTimer();
                updateRecordingButtons(false);
            };
            
            recorder.onRecordingError = function(error) {
                console.error('âŒ å½•åˆ¶é”™è¯¯:', error);
                showMessage(`å½•åˆ¶é”™è¯¯: ${error.message}`, 'error');
                updateRecordingStatus('å½•åˆ¶é”™è¯¯');
                stopRecordingTimer();
                updateRecordingButtons(false);
            };
            
            recorder.onTimerUpdate = function(seconds) {
                updateTimerDisplay(seconds);
            };
        }
        
        // æ›´æ–°æ—¶é—´æ˜¾ç¤º
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('zh-CN', {hour12: false});
            const dateString = now.toLocaleDateString('zh-CN');
            document.getElementById('currentTime').textContent = `${dateString} ${timeString}`;
        }
        
        // ğŸ› ï¸ ä¿®å¤ï¼šåˆå§‹åŒ–æ‘„åƒå¤´ - åº”ç”¨è´¨é‡é…ç½®
        async function initCamera() {
            try {
                const devices = await navigator.mediaDevices.enumerateDevices();
                const videoDevices = devices.filter(device => device.kind === 'videoinput');
                
                const cameraSelect = document.getElementById('cameraSelect');
                cameraSelect.innerHTML = '<option value="">é€‰æ‹©æ‘„åƒå¤´...</option>';
                
                videoDevices.forEach((device, index) => {
                    const option = document.createElement('option');
                    option.value = device.deviceId;
                    option.text = device.label || `æ‘„åƒå¤´ ${index + 1}`;
                    cameraSelect.appendChild(option);
                });
                
                // ğŸ› ï¸ ä¿®å¤ï¼šåº”ç”¨ä¿å­˜çš„æ‘„åƒå¤´é€‰æ‹©
                const config = window.ReturnUnpackSystem.recordingConfig;
                if (config.cameraId && videoDevices.some(d => d.deviceId === config.cameraId)) {
                    cameraSelect.value = config.cameraId;
                }
                
                if (videoDevices.length > 0) {
                    const defaultDeviceId = config.cameraId || videoDevices[0].deviceId;
                    await startCamera(defaultDeviceId);
                }
                
                document.getElementById('recordButton').disabled = false;
                
                // ğŸ› ï¸ ä¿®å¤ï¼šæ‘„åƒå¤´é€‰æ‹©å˜åŒ–äº‹ä»¶
                cameraSelect.addEventListener('change', async function() {
                    const deviceId = this.value;
                    config.updateCameraId(deviceId);
                    await startCamera(deviceId);
                });
                
            } catch (error) {
                console.error('æ‘„åƒå¤´åˆå§‹åŒ–å¤±è´¥:', error);
                document.getElementById('cameraSelect').innerHTML = '<option value="">æ‘„åƒå¤´è®¿é—®å¤±è´¥</option>';
                document.getElementById('recordButton').disabled = true;
            }
        }
        
        // ğŸ› ï¸ ä¿®å¤ï¼šå¯åŠ¨æ‘„åƒå¤´ - åº”ç”¨è´¨é‡é…ç½®
        async function startCamera(deviceId) {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
            }
            
            try {
                const config = window.ReturnUnpackSystem.recordingConfig;
                const quality = config.quality || 'medium';
                
                // ğŸ› ï¸ ä¿®å¤ï¼šæ ¹æ®è´¨é‡è®¾ç½®æ‘„åƒå¤´çº¦æŸ
                const constraints = getCameraConstraints(deviceId, quality);
                
                console.log(`ğŸ“· å¯åŠ¨æ‘„åƒå¤´ï¼Œè´¨é‡: ${quality}, è®¾å¤‡: ${deviceId || 'é»˜è®¤'}`);
                console.log('ğŸ“· æ‘„åƒå¤´çº¦æŸ:', JSON.stringify(constraints.video));
                
                currentStream = await navigator.mediaDevices.getUserMedia(constraints);
                const videoElement = document.getElementById('cameraFeed');
                videoElement.srcObject = currentStream;
                
                document.querySelector('.no-camera').style.display = 'none';
                videoElement.style.display = 'block';
                
                console.log('ğŸ“· æ‘„åƒå¤´å¯åŠ¨æˆåŠŸ');
                
                const recorder = window.ReturnUnpackSystem.modules.recorder;
                if (recorder && recorder.setVideoStream) {
                    recorder.setVideoStream(currentStream);
                }
                
            } catch (error) {
                console.error('ğŸ“· æ‘„åƒå¤´å¯åŠ¨å¤±è´¥:', error);
                document.querySelector('.no-camera').style.display = 'flex';
                document.getElementById('cameraFeed').style.display = 'none';
                showMessage(`æ‘„åƒå¤´å¯åŠ¨å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // ğŸ› ï¸ ä¿®å¤ï¼šè·å–æ‘„åƒå¤´çº¦æŸé…ç½®
        function getCameraConstraints(deviceId, quality) {
            const constraints = {
                video: {
                    deviceId: deviceId ? { exact: deviceId } : undefined,
                },
                audio: false
            };
            
            // ğŸ› ï¸ ä¿®å¤ï¼šæ ¹æ®è´¨é‡è®¾ç½®åˆ†è¾¨ç‡
            switch(quality) {
                case 'low':
                    constraints.video.width = { ideal: 640 };
                    constraints.video.height = { ideal: 480 };
                    constraints.video.frameRate = { ideal: 15 };
                    break;
                case 'medium':
                    constraints.video.width = { ideal: 1280 };
                    constraints.video.height = { ideal: 720 };
                    constraints.video.frameRate = { ideal: 30 };
                    break;
                case 'high':
                    constraints.video.width = { ideal: 1920 };
                    constraints.video.height = { ideal: 1080 };
                    constraints.video.frameRate = { ideal: 30 };
                    break;
                case 'max':
                    constraints.video.width = { ideal: 3840 };
                    constraints.video.height = { ideal: 2160 };
                    constraints.video.frameRate = { ideal: 30 };
                    break;
                default:
                    constraints.video.width = { ideal: 1280 };
                    constraints.video.height = { ideal: 720 };
                    constraints.video.frameRate = { ideal: 30 };
            }
            
            // ğŸ› ï¸ ä¿®å¤ï¼šæ·»åŠ æ­£æ–¹å½¢æ¯”ä¾‹è¦æ±‚
            constraints.video.aspectRatio = { ideal: 1 };
            
            return constraints;
        }
        
        // è®¾ç½®é¡µé¢å¯¼èˆª
        function setupPageNavigation() {
            const navButtons = document.querySelectorAll('.nav-btn');
            const pageContainer = document.getElementById('pageContainer');
            const appContainer = document.querySelector('.app-container');
            
            navButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const page = this.getAttribute('data-page');
                    
                    navButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    if (page === 'home') {
                        appContainer.style.display = 'flex';
                        pageContainer.classList.remove('active');
                    } else {
                        appContainer.style.display = 'none';
                        pageContainer.classList.add('active');
                        
                        document.querySelectorAll('.page').forEach(p => {
                            p.style.display = 'none';
                        });
                        
                        const targetPage = document.getElementById(page + 'Page');
                        if (targetPage) {
                            targetPage.style.display = 'block';
                            
                            if (page === 'database') {
                                loadDatabaseData();
                            }
                        }
                    }
                    
                    currentPage = page;
                });
            });
            
            document.querySelectorAll('.close-page').forEach(button => {
                button.addEventListener('click', function() {
                    pageContainer.classList.remove('active');
                    appContainer.style.display = 'flex';
                    
                    navButtons.forEach(btn => {
                        if (btn.getAttribute('data-page') === 'home') {
                            btn.classList.add('active');
                        } else {
                            btn.classList.remove('active');
                        }
                    });
                    
                    currentPage = 'home';
                });
            });
        }
        
        // è®¾ç½®æ•°æ®åº“é¡µé¢äº‹ä»¶
        function setupDatabasePage() {
            document.getElementById('refreshDB')?.addEventListener('click', function() {
                loadDatabaseData();
                showMessage('æ•°æ®å·²åˆ·æ–°', 'success');
            });
            
            document.getElementById('searchDB')?.addEventListener('click', function() {
                const searchTerm = prompt('è¯·è¾“å…¥æœç´¢å…³é”®è¯ï¼ˆè®¢å•å·ã€å¤‡æ³¨ç­‰ï¼‰:', '');
                if (searchTerm) {
                    searchDatabaseData(searchTerm);
                }
            });
            
            document.getElementById('clearDB')?.addEventListener('click', async function() {
                if (confirm('âš ï¸  è­¦å‘Šï¼šç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                    if (confirm('è¯·å†æ¬¡ç¡®è®¤ï¼šçœŸçš„è¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿ')) {
                        await clearDatabase();
                    }
                }
            });
            
            document.getElementById('selectExcelFileBtn')?.addEventListener('click', function() {
                document.getElementById('excelFileInput').click();
            });
            
            document.getElementById('excelFileInput')?.addEventListener('change', function(e) {
                const file = e.target.files[0];
                const fileNameSpan = document.getElementById('excelFileName');
                const fileSizeSpan = document.getElementById('fileSize');
                const importBtn = document.getElementById('startExcelImportBtn');
                
                if (file) {
                    fileNameSpan.textContent = file.name;
                    fileSizeSpan.textContent = formatFileSize(file.size);
                    importBtn.disabled = false;
                    
                    showMessage(`å·²é€‰æ‹©æ–‡ä»¶: ${file.name} (${formatFileSize(file.size)})`, 'info');
                } else {
                    fileNameSpan.textContent = 'æœªé€‰æ‹©æ–‡ä»¶';
                    fileSizeSpan.textContent = '';
                    importBtn.disabled = true;
                }
            });
            
            document.getElementById('startExcelImportBtn')?.addEventListener('click', async function() {
                const fileInput = document.getElementById('excelFileInput');
                if (!fileInput.files[0]) {
                    showMessage('è¯·å…ˆé€‰æ‹©Excelæ–‡ä»¶', 'error');
                    return;
                }
                
                const file = fileInput.files[0];
                await startExcelImport(file);
            });
            
            document.getElementById('startCleanupBtn')?.addEventListener('click', async function() {
                await startDataCleanup();
            });
            
            document.getElementById('backupData')?.addEventListener('click', function() {
                backupDatabase();
            });
            
            document.getElementById('restoreData')?.addEventListener('click', function() {
                restoreDatabase();
            });
            
            document.getElementById('applyFilter')?.addEventListener('click', function() {
                applyDatabaseFilter();
            });
            
            document.getElementById('resetFilter')?.addEventListener('click', function() {
                resetDatabaseFilter();
            });
            
            document.getElementById('selectAll')?.addEventListener('change', function(e) {
                const checkboxes = document.querySelectorAll('.record-checkbox');
                checkboxes.forEach(cb => {
                    cb.checked = e.target.checked;
                });
            });
        }
        
        // è®¾ç½®æ™ºèƒ½æ‰«ç è¾“å…¥äº‹ä»¶
        function setupSmartScanInput() {
            const orderInput = document.getElementById('orderInput');
            const scanButton = document.getElementById('scanButton');
            const manualButton = document.getElementById('manualButton');
            const searchResults = document.getElementById('orderSearchResults');
            
            orderInput.addEventListener('input', function() {
                clearTimeout(searchTimer);
                const value = this.value.trim();
                
                if (value.length >= 2) {
                    searchTimer = setTimeout(() => {
                        searchOrders(value);
                    }, 300);
                } else {
                    hideSearchResults();
                }
            });
            
            orderInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && this.value.trim()) {
                    hideSearchResults();
                    processScanCode(this.value.trim());
                    this.value = '';
                }
            });
            
            document.addEventListener('click', function(e) {
                if (!orderInput.contains(e.target) && !searchResults.contains(e.target)) {
                    hideSearchResults();
                }
            });
            
            scanButton.addEventListener('click', function() {
                orderInput.focus();
                showMessage('è¯·æ‰«æå¿«é€’å•å·æˆ–æ‰‹åŠ¨è¾“å…¥', 'info');
            });
            
            manualButton.addEventListener('click', function() {
                const orderNumber = prompt('è¯·è¾“å…¥è®¢å•å·:', '');
                if (orderNumber && orderNumber.trim()) {
                    hideSearchResults();
                    processScanCode(orderNumber.trim());
                }
            });
        }
        
        // æœç´¢è®¢å•
        async function searchOrders(searchTerm) {
            try {
                if (!window.ReturnUnpackSystem || !window.ReturnUnpackSystem.modules.database) {
                    return;
                }
                
                const results = await window.ReturnUnpackSystem.modules.database.searchOrders(searchTerm);
                
                const searchResults = document.getElementById('orderSearchResults');
                searchResults.innerHTML = '';
                
                if (results.length === 0) {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'search-result-item';
                    resultItem.innerHTML = `<div style="color:#999;">æœªæ‰¾åˆ°åŒ¹é…çš„è®¢å•</div>`;
                    searchResults.appendChild(resultItem);
                } else {
                    const displayResults = results.slice(0, 5);
                    
                    displayResults.forEach(order => {
                        const resultItem = document.createElement('div');
                        resultItem.className = 'search-result-item';
                        resultItem.innerHTML = `
                            <div class="order-number">${order.orderNumber || 'æœªçŸ¥'}</div>
                            <div class="shop-name">åº—é“º: ${order.shopName || 'æœªå¡«å†™'}</div>
                            <div class="express-number">å‘è´§: ${order.expressNumber || 'æœªå¡«å†™'}</div>
                        `;
                        
                        resultItem.addEventListener('click', function() {
                            document.getElementById('orderInput').value = order.orderNumber;
                            hideSearchResults();
                            processScanCode(order.orderNumber);
                        });
                        
                        searchResults.appendChild(resultItem);
                    });
                    
                    if (results.length > 5) {
                        const moreItem = document.createElement('div');
                        moreItem.className = 'search-result-item';
                        moreItem.innerHTML = `<div style="color:#666;">è¿˜æœ‰ ${results.length - 5} ä¸ªç»“æœ...</div>`;
                        searchResults.appendChild(moreItem);
                    }
                }
                
                searchResults.style.display = 'block';
                
            } catch (error) {
                console.error('æœç´¢è®¢å•å¤±è´¥:', error);
                hideSearchResults();
            }
        }
        
        // éšè—æœç´¢ç»“æœ
        function hideSearchResults() {
            const searchResults = document.getElementById('orderSearchResults');
            searchResults.style.display = 'none';
            searchResults.innerHTML = '';
        }
        
        // ğŸ› ï¸ ä¿®å¤ï¼šå¼ºåŒ–å½•åˆ¶æŒ‰é’®äº‹ä»¶
        function setupRecordingButtons() {
            const recordBtn = document.getElementById('recordButton');
            const pauseBtn = document.getElementById('pauseButton');
            const stopBtn = document.getElementById('stopButton');
            const cameraBtn = document.getElementById('cameraButton');
            
            // å¼€å§‹å½•åˆ¶æŒ‰é’®
            recordBtn.addEventListener('click', async function() {
                if (!currentOrder || !currentOrder.orderNumber) {
                    showMessage('è¯·å…ˆæ‰«æè®¢å•å·', 'error');
                    return;
                }
                
                console.log(`ğŸ¬ [recordBtn] å¼€å§‹å½•åˆ¶ï¼Œå½“å‰è®¢å•: ${currentOrder.orderNumber}`);
                console.log(`â±ï¸ å½•åˆ¶æ—¶é•¿é…ç½®: ${recordingDuration}ç§’`);
                
                try {
                    const recorder = window.ReturnUnpackSystem.modules.recorder;
                    if (!recorder) {
                        showMessage('å½•åˆ¶æ¨¡å—æœªåˆå§‹åŒ–', 'error');
                        return;
                    }
                    
                    // ğŸ› ï¸ ä¿®å¤ï¼šä½¿ç”¨å…¨å±€å½•åˆ¶æ—¶é•¿å˜é‡
                    const duration = recordingDuration;
                    const quality = window.ReturnUnpackSystem.recordingConfig.quality;
                    
                    const metadata = {
                        orderNumber: currentOrder.orderNumber,
                        shopName: currentOrder.shopName || 'æœªçŸ¥åº—é“º',
                        duration: duration,
                        quality: quality,
                        timestamp: new Date().toISOString()
                    };
                    
                    console.log('ğŸ“ å½•åˆ¶å…ƒæ•°æ®:', metadata);
                    
                    // ğŸ› ï¸ ä¿®å¤ï¼šä¼ é€’å½•åˆ¶æ—¶é•¿é…ç½®åˆ°å½•åˆ¶æ¨¡å—
                    const result = recorder.startRecording(currentOrder.orderNumber, metadata);
                    
                    if (result) {
                        console.log('ğŸ¬ å½•åˆ¶å¼€å§‹æˆåŠŸ');
                        isRecording = true;
                        
                        updateRecordingStatus('å½•åˆ¶ä¸­');
                        startRecordingTimer();
                        updateRecordingButtons(true);
                        
                        showMessage('å¼€å§‹å½•åˆ¶æ‹†åŒ…è§†é¢‘', 'success');
                    } else {
                        showMessage('å¼€å§‹å½•åˆ¶å¤±è´¥', 'error');
                    }
                    
                } catch (error) {
                    console.error('å½•åˆ¶å¼€å§‹å¤±è´¥:', error);
                    showMessage(`å½•åˆ¶å¤±è´¥: ${error.message}`, 'error');
                }
            });
            
            // æš‚åœæŒ‰é’®
            pauseBtn.addEventListener('click', function() {
                const recorder = window.ReturnUnpackSystem.modules.recorder;
                if (recorder && recorder.togglePause) {
                    const isPaused = recorder.togglePause();
                    
                    if (isPaused) {
                        pauseBtn.innerHTML = '<i class="fas fa-play"></i> ç»§ç»­';
                        recordBtn.innerHTML = '<i class="fas fa-play"></i> ç»§ç»­å½•åˆ¶';
                        updateRecordingStatus('å½•åˆ¶æš‚åœ');
                    } else {
                        pauseBtn.innerHTML = '<i class="fas fa-pause"></i> æš‚åœ';
                        recordBtn.innerHTML = '<i class="fas fa-pause"></i> æš‚åœå½•åˆ¶';
                        updateRecordingStatus('å½•åˆ¶ä¸­');
                    }
                }
            });
            
            // ğŸ› ï¸ ä¿®å¤ï¼šå¼ºåŒ–åœæ­¢æŒ‰é’®å¤„ç†
            stopBtn.addEventListener('click', async function() {
                try {
                    const recorder = window.ReturnUnpackSystem.modules.recorder;
                    if (recorder && recorder.stopRecording) {
                        console.log('ğŸ›‘ åœæ­¢å½•åˆ¶æŒ‰é’®è¢«ç‚¹å‡»');
                        const videoInfo = recorder.stopRecording();
                        
                        // ğŸ› ï¸ æ³¨æ„ï¼šè§†é¢‘ä¿å­˜ç”± recorder.js é€šè¿‡ handleVideoRecorded å›è°ƒå¤„ç†
                        // æ‰€ä»¥è¿™é‡Œä¸éœ€è¦å†æ¬¡è°ƒç”¨ saveVideoToOrder
                        
                        // é‡ç½®å½•åˆ¶çŠ¶æ€
                        isRecording = false;
                        updateRecordingStatus('å‡†å¤‡å°±ç»ª');
                        stopRecordingTimer();
                        updateRecordingButtons(false);
                    }
                } catch (error) {
                    console.error('å½•åˆ¶åœæ­¢å¤±è´¥:', error);
                    showMessage(`åœæ­¢å½•åˆ¶å¤±è´¥: ${error.message}`, 'error');
                }
            });
            
            // æ‹ç…§æŒ‰é’®
            cameraBtn.addEventListener('click', function() {
                const recorder = window.ReturnUnpackSystem.modules.recorder;
                if (recorder && recorder.capturePhoto) {
                    recorder.capturePhoto();
                } else {
                    takePhoto();
                }
            });
        }
        
        // æ›´æ–°å½•åˆ¶æŒ‰é’®çŠ¶æ€
        function updateRecordingButtons(isRecording) {
            const recordBtn = document.getElementById('recordButton');
            const pauseBtn = document.getElementById('pauseButton');
            const stopBtn = document.getElementById('stopButton');
            
            if (isRecording) {
                recordBtn.disabled = false;
                recordBtn.innerHTML = '<i class="fas fa-pause"></i> æš‚åœå½•åˆ¶';
                pauseBtn.disabled = false;
                stopBtn.disabled = false;
            } else {
                recordBtn.disabled = false;
                recordBtn.innerHTML = '<i class="fas fa-circle"></i> å¼€å§‹å½•åˆ¶';
                pauseBtn.disabled = true;
                pauseBtn.innerHTML = '<i class="fas fa-pause"></i> æš‚åœ';
                stopBtn.disabled = true;
            }
        }
        
        // è®¾ç½®è®¢å•è¯¦æƒ…äº‹ä»¶
        function setupOrderDetailEvents() {
            document.getElementById('closeOrderDetail')?.addEventListener('click', function() {
                hideOrderDetail();
            });
            
            // ğŸ› ï¸ ä¿®å¤ï¼šè®¾ç½®å¤‡æ³¨ä¿å­˜äº‹ä»¶
            document.getElementById('saveOrderNotes')?.addEventListener('click', async function() {
                const notes = document.getElementById('detailOrderNotes').value;
                if (!currentOrder || !currentOrder.orderNumber) {
                    showMessage('è¯·å…ˆé€‰æ‹©è®¢å•', 'warning');
                    return;
                }
                
                try {
                    // è·å–å½“å‰æŸåçŠ¶æ€
                    const selectedDamageBtn = document.querySelector('.damage-btn.selected');
                    const damageStatus = selectedDamageBtn ? selectedDamageBtn.getAttribute('data-damage') : 'å®Œå¥½';
                    
                    // ä¿å­˜æŸåçŠ¶æ€å’Œå¤‡æ³¨
                    await saveDamageStatusOnly(damageStatus, notes);
                } catch (error) {
                    console.error('ä¿å­˜å¤‡æ³¨å¤±è´¥:', error);
                    showMessage('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
                }
            });
            
            document.getElementById('startVideoRecording')?.addEventListener('click', function() {
                if (!currentOrder || !currentOrder.orderNumber) {
                    showMessage('è¯·å…ˆé€‰æ‹©è®¢å•', 'warning');
                    return;
                }
                
                document.getElementById('recordButton').click();
            });
            
            document.getElementById('stopVideoRecording')?.addEventListener('click', function() {
                document.getElementById('stopButton').click();
            });
        }
        
        // å¤„ç†æ‰«ç è¾“å…¥
        async function processScanCode(code) {
            console.log('ğŸ“Ÿ æ‰«ç è¾“å…¥:', code);
            
            try {
                if (!window.ReturnUnpackSystem || !window.ReturnUnpackSystem.modules.database) {
                    showMessage('æ•°æ®åº“æ¨¡å—æœªåˆå§‹åŒ–', 'error');
                    return;
                }
                
                let orders = await window.ReturnUnpackSystem.modules.database.searchOrders(code);
                
                if (orders.length === 0) {
                    console.log('ğŸ” æ™ºèƒ½æœç´¢æœªæ‰¾åˆ°ï¼Œå°è¯•ç²¾ç¡®æŸ¥è¯¢...');
                    const result = await window.ReturnUnpackSystem.modules.database.getOrder(code);
                    if (result && result.success && result.data) {
                        orders = [result.data];
                    } else {
                        showMessage('æœªæ‰¾åˆ°åŒ¹é…çš„è®¢å•', 'warning');
                        return;
                    }
                }
                
                if (orders.length > 0) {
                    await displayOrderDetail(orders[0]);
                    
                    if (orders.length > 1) {
                        showMessage(`æ‰¾åˆ° ${orders.length} ä¸ªåŒ¹é…è®¢å•ï¼Œæ˜¾ç¤ºç¬¬ä¸€ä¸ª`, 'info');
                    }
                }
                
                playSound('beep');
                
                // ğŸ› ï¸ ä¿®å¤ï¼šä½¿ç”¨é…ç½®ä¸­çš„autoStart
                const config = window.ReturnUnpackSystem.recordingConfig;
                if (config.autoStart && orders.length > 0 && !isRecording) {
                    setTimeout(() => {
                        document.getElementById('recordButton').click();
                    }, 1000);
                }
                
                updateTodayStats();
                
            } catch (error) {
                console.error('å¤„ç†æ‰«ç è¾“å…¥å¤±è´¥:', error);
                showMessage(`å¤„ç†å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // ğŸ› ï¸ ä¿®å¤ï¼šæ˜¾ç¤ºè®¢å•è¯¦æƒ…æ—¶ç¡®ä¿åŠ è½½å®Œæ•´æ•°æ®
        async function displayOrderDetail(order) {
            try {
                if (!window.ReturnUnpackSystem || !window.ReturnUnpackSystem.modules.database) {
                    console.error('âŒ æ•°æ®åº“æ¨¡å—æœªåˆå§‹åŒ–');
                    return;
                }
                
                // ğŸ› ï¸ ä¿®å¤ï¼šä»æ•°æ®åº“è·å–å®Œæ•´è®¢å•æ•°æ®
                console.log(`ğŸ” æ­£åœ¨è·å–è®¢å•è¯¦æƒ…: ${order.orderNumber}`);
                const orderResult = await window.ReturnUnpackSystem.modules.database.getOrder(order.orderNumber);
                
                // ğŸ› ï¸ ä¿®å¤ï¼šæ­£ç¡®å¤„ç†è¿”å›å€¼æ ¼å¼
                if (!orderResult || !orderResult.success || !orderResult.data) {
                    console.error('âŒ è·å–è®¢å•ä¿¡æ¯å¤±è´¥:', orderResult?.message || 'æœªçŸ¥é”™è¯¯');
                    showMessage(`è·å–è®¢å•ä¿¡æ¯å¤±è´¥: ${orderResult?.message || 'è®¢å•ä¸å­˜åœ¨'}`, 'error');
                    return;
                }
                
                currentOrder = orderResult.data;
                
                console.log('ğŸ“‹ æ˜¾ç¤ºè®¢å•è¯¦æƒ…ï¼ˆå®Œæ•´æ•°æ®ï¼‰:', {
                    orderNumber: currentOrder.orderNumber,
                    shopName: currentOrder.shopName,
                    status: currentOrder.status,
                    damage: currentOrder.damage || currentOrder.damageType,
                    expressNumber: currentOrder.expressNumber,
                    trackingNumber: currentOrder.trackingNumber
                });
                
                const detailCard = document.getElementById('orderDetailCard');
                detailCard.style.display = 'block';
                
                document.getElementById('detailOrderNumber').textContent = currentOrder.orderNumber || 'æœªå¡«å†™';
                document.getElementById('detailShopName').textContent = currentOrder.shopName || 'æœªå¡«å†™';
                document.getElementById('detailExpressNumber').textContent = currentOrder.expressNumber || currentOrder.shippingTrackingNumber || 'æœªå¡«å†™';
                document.getElementById('detailTrackingNumber').textContent = currentOrder.trackingNumber || currentOrder.returnTrackingNumber || currentOrder.scanCode || 'æœªå¡«å†™';
                document.getElementById('detailSkuInfo').textContent = currentOrder.skuInfo || 'æœªå¡«å†™';
                document.getElementById('detailOrderNotes').value = currentOrder.notes || '';
                
                document.querySelectorAll('.damage-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                
                const damageStatus = currentOrder.damage || currentOrder.damageType || 'å®Œå¥½';
                const damageBtn = document.querySelector(`.damage-btn[data-damage="${damageStatus}"]`);
                if (damageBtn) {
                    damageBtn.classList.add('selected');
                }
                
                const videoRecorded = currentOrder.videoFile || currentOrder.videoData;
                document.getElementById('startVideoRecording').disabled = videoRecorded || isRecording;
                document.getElementById('stopVideoRecording').disabled = !isRecording;
                
                const status = currentOrder.status || 'å¾…å¤„ç†';
                console.log(`âœ… å·²åŠ è½½è®¢å•: ${currentOrder.orderNumber}, çŠ¶æ€: ${status}, åº—é“º: ${currentOrder.shopName || 'æ— '}`);
                
                showMessage(`å·²åŠ è½½è®¢å•: ${currentOrder.orderNumber} (${status})`, 'success');
                
            } catch (error) {
                console.error('æ˜¾ç¤ºè®¢å•è¯¦æƒ…å¤±è´¥:', error);
                showMessage(`åŠ è½½è®¢å•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æ›´æ–°è®¢å•è¯¦æƒ…æ˜¾ç¤º
        function updateOrderDetailDisplay() {
            if (!currentOrder) return;
            
            document.querySelectorAll('.damage-btn').forEach(btn => {
                btn.classList.remove('selected');
                const damageStatus = btn.getAttribute('data-damage');
                if (damageStatus === currentOrder.damage || damageStatus === currentOrder.damageType) {
                    btn.classList.add('selected');
                }
            });
            
            if (currentOrder.notes) {
                document.getElementById('detailOrderNotes').value = currentOrder.notes;
            }
            
            if (currentOrder.shopName) {
                document.getElementById('detailShopName').textContent = currentOrder.shopName;
            }
            
            console.log('âœ… è®¢å•è¯¦æƒ…å·²æ›´æ–°:', {
                orderNumber: currentOrder.orderNumber,
                damage: currentOrder.damage || currentOrder.damageType,
                shopName: currentOrder.shopName,
                status: currentOrder.status
            });
        }
        
        // éšè—è®¢å•è¯¦æƒ…
        function hideOrderDetail() {
            const detailCard = document.getElementById('orderDetailCard');
            detailCard.style.display = 'none';
            currentOrder = null;
        }
        
        // ä¸‹è½½è§†é¢‘æ–‡ä»¶
        function downloadVideoFile(videoBlob, filename) {
            try {
                console.log(`ğŸ“¥ å¼€å§‹ä¸‹è½½è§†é¢‘æ–‡ä»¶: ${filename}`);
                
                const url = URL.createObjectURL(videoBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                link.style.display = 'none';
                
                document.body.appendChild(link);
                link.click();
                
                setTimeout(() => {
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                }, 100);
                
                console.log(`âœ… è§†é¢‘æ–‡ä»¶ä¸‹è½½å®Œæˆ: ${filename}`);
            } catch (error) {
                console.error('âŒ ä¸‹è½½è§†é¢‘æ–‡ä»¶å¤±è´¥:', error);
            }
        }
        
        // å¼€å§‹å½•åˆ¶è®¡æ—¶å™¨
        function startRecordingTimer() {
            recordingSeconds = 0;
            clearInterval(recordingTimerInterval);
            
            recordingTimerInterval = setInterval(() => {
                recordingSeconds++;
                updateTimerDisplay(recordingSeconds);
                
                // ğŸ› ï¸ ä¿®å¤ï¼šæ£€æŸ¥æ˜¯å¦è¾¾åˆ°é…ç½®çš„å½•åˆ¶æ—¶é•¿
                if (recordingSeconds >= recordingDuration) {
                    console.log(`â±ï¸ è¾¾åˆ°é…ç½®çš„å½•åˆ¶æ—¶é•¿: ${recordingDuration}ç§’ï¼Œè‡ªåŠ¨åœæ­¢å½•åˆ¶`);
                    document.getElementById('stopButton').click();
                }
            }, 1000);
        }
        
        // åœæ­¢å½•åˆ¶è®¡æ—¶å™¨
        function stopRecordingTimer() {
            clearInterval(recordingTimerInterval);
            recordingTimerInterval = null;
            recordingSeconds = 0;
            updateTimerDisplay(0);
        }
        
        // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
        function updateTimerDisplay(seconds) {
            const minutes = Math.floor(seconds / 60).toString().padStart(2, '0');
            const secs = (seconds % 60).toString().padStart(2, '0');
            document.getElementById('recordingTimer').textContent = `${minutes}:${secs}`;
        }
        
        // æ›´æ–°å½•åˆ¶çŠ¶æ€æ˜¾ç¤º
        function updateRecordingStatus(status) {
            const statusElement = document.getElementById('recordingStatus');
            statusElement.textContent = status;
            
            if (status === 'å½•åˆ¶ä¸­') {
                statusElement.style.color = '#ff4757';
            } else if (status === 'å½•åˆ¶å®Œæˆ' || status === 'å‡†å¤‡å°±ç»ª') {
                statusElement.style.color = '#2ed573';
            } else if (status === 'å½•åˆ¶æš‚åœ') {
                statusElement.style.color = '#ffa502';
            } else {
                statusElement.style.color = '#666';
            }
        }
        
        // æ‹ç…§åŠŸèƒ½
        function takePhoto() {
            const video = document.getElementById('cameraFeed');
            if (!video || !video.videoWidth) {
                showMessage('æ‘„åƒå¤´æœªå°±ç»ª', 'error');
                return;
            }
            
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');
            
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            const imageData = canvas.toDataURL('image/png');
            
            const link = document.createElement('a');
            const timestamp = new Date().getTime();
            link.download = `photo_${timestamp}.png`;
            link.href = imageData;
            link.click();
            
            showMessage('æ‹ç…§æˆåŠŸ', 'success');
        }
        
        // æ·»åŠ åˆ°æœ€è¿‘å½•åˆ¶åˆ—è¡¨
        function addToRecentList(orderNumber, videoFileName) {
            const recentList = document.getElementById('recentList');
            
            const emptyState = recentList.querySelector('.empty-state');
            if (emptyState) {
                emptyState.remove();
            }
            
            const recentItem = document.createElement('div');
            recentItem.className = 'recent-item';
            recentItem.innerHTML = `
                <div style="display:flex; align-items:center; gap:10px; padding:10px; border-bottom:1px solid #eee;">
                    <i class="fas fa-video" style="color:#4a6ee0;"></i>
                    <div style="flex:1;">
                        <div style="font-weight:500;">${orderNumber}</div>
                        <div style="font-size:12px; color:#666;">${new Date().toLocaleString('zh-CN')}</div>
                        <div style="font-size:11px; color:#999;">${videoFileName}</div>
                    </div>
                    <button class="btn btn-sm" style="padding:4px 8px; font-size:12px; background:#4a6ee0; color:white;" onclick="playVideo('${orderNumber}')">
                        <i class="fas fa-play"></i> æ’­æ”¾
                    </button>
                </div>
            `;
            
            recentList.insertBefore(recentItem, recentList.firstChild);
            
            const items = recentList.querySelectorAll('.recent-item');
            if (items.length > 10) {
                items[items.length - 1].remove();
            }
        }
        
        // æ’­æ”¾è§†é¢‘
        function playVideo(orderNumber) {
            showMessage(`æ’­æ”¾è§†é¢‘: ${orderNumber}`, 'info');
        }
        
        // åŠ è½½æ•°æ®åº“æ•°æ®
        async function loadDatabaseData() {
            try {
                showMessage('æ­£åœ¨åŠ è½½æ•°æ®...', 'info');
                
                let orders = [];
                
                if (window.ReturnUnpackSystem && window.ReturnUnpackSystem.modules.database) {
                    orders = await window.ReturnUnpackSystem.modules.database.getAllOrders();
                    
                    const formattedData = orders.map(order => ({
                        id: order.orderNumber,
                        orderNumber: order.orderNumber,
                        shopName: order.shopName || '',
                        scanTime: order.scanTime ? new Date(order.scanTime).toLocaleString('zh-CN') : 'æœªçŸ¥',
                        status: order.status || 'å¾…å¤„ç†',
                        damage: order.damage || order.damageType || 'å®Œå¥½',
                        videoFile: order.videoData ? `video_${order.orderNumber}.mp4` : null,
                        notes: order.notes || '',
                        skuInfo: order.skuInfo || ''
                    }));
                    
                    updateDatabaseTable(formattedData);
                    updateDatabaseStats(formattedData);
                } else {
                    const mockData = generateMockData(15);
                    updateDatabaseTable(mockData);
                    updateDatabaseStats(mockData);
                }
                
                showMessage('æ•°æ®åŠ è½½å®Œæˆ', 'success');
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                showMessage('æ•°æ®åŠ è½½å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // æœç´¢æ•°æ®åº“æ•°æ®
        async function searchDatabaseData(searchTerm) {
            try {
                showMessage(`æœç´¢: ${searchTerm}`, 'info');
                
                if (window.ReturnUnpackSystem && window.ReturnUnpackSystem.modules.database) {
                    const results = await window.ReturnUnpackSystem.modules.database.searchOrders(searchTerm);
                    
                    const formattedData = results.map(order => ({
                        id: order.orderNumber,
                        orderNumber: order.orderNumber,
                        shopName: order.shopName || '',
                        scanTime: order.scanTime ? new Date(order.scanTime).toLocaleString('zh-CN') : 'æœªçŸ¥',
                        status: order.status || 'å¾…å¤„ç†',
                        damage: order.damage || order.damageType || 'å®Œå¥½',
                        videoFile: order.videoData ? `video_${order.orderNumber}.mp4` : null,
                        notes: order.notes || ''
                    }));
                    
                    updateDatabaseTable(formattedData);
                    updateDatabaseStats(formattedData);
                    
                    showMessage(`æ‰¾åˆ° ${results.length} æ¡è®°å½•`, 'success');
                } else {
                    showMessage('æ•°æ®åº“æ¨¡å—æœªåŠ è½½', 'error');
                }
            } catch (error) {
                console.error('æœç´¢å¤±è´¥:', error);
                showMessage('æœç´¢å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // æ¸…ç©ºæ•°æ®åº“
        async function clearDatabase() {
            try {
                if (window.ReturnUnpackSystem && window.ReturnUnpackSystem.modules.database) {
                    await window.ReturnUnpackSystem.modules.database.clearAll();
                    loadDatabaseData();
                    showMessage('æ•°æ®åº“å·²æ¸…ç©º', 'success');
                } else {
                    showMessage('æ•°æ®åº“æ¨¡å—æœªåŠ è½½', 'error');
                }
            } catch (error) {
                console.error('æ¸…ç©ºæ•°æ®åº“å¤±è´¥:', error);
                showMessage('æ¸…ç©ºå¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // Excelå¯¼å…¥åŠŸèƒ½
        async function startExcelImport(file) {
            const importBtn = document.getElementById('startExcelImportBtn');
            const progressDiv = document.getElementById('importProgress');
            const resultDiv = document.getElementById('importResult');
            const progressBar = document.getElementById('progressBar');
            const progressPercent = document.getElementById('progressPercent');
            const progressStatus = document.getElementById('progressStatus');
            const progressCount = document.getElementById('progressCount');
            
            try {
                importBtn.disabled = true;
                importBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> å¯¼å…¥ä¸­...';
                
                progressDiv.style.display = 'block';
                resultDiv.style.display = 'none';
                
                progressBar.style.width = '0%';
                progressPercent.textContent = '0%';
                progressStatus.textContent = 'æ­£åœ¨è¯»å–æ–‡ä»¶...';
                progressCount.textContent = '0/0';
                
                const mergeStrategy = document.getElementById('mergeStrategy').value;
                
                console.log('å¼€å§‹å¯¼å…¥Excelæ–‡ä»¶:', file.name, 'ç­–ç•¥:', mergeStrategy);
                
                if (!window.ReturnUnpackSystem || !window.ReturnUnpackSystem.modules.exchange) {
                    throw new Error('æ•°æ®äº¤æ¢æ¨¡å—æœªåˆå§‹åŒ–');
                }
                
                const result = await window.ReturnUnpackSystem.modules.exchange.importFromFile(file, mergeStrategy);
                
                progressBar.style.width = '100%';
                progressPercent.textContent = '100%';
                progressStatus.textContent = 'å¯¼å…¥å®Œæˆ';
                progressCount.textContent = `${result.stats.total}/${result.stats.total}`;
                
                showImportResult({
                    success: true,
                    total: result.stats.total,
                    created: result.stats.added,
                    updated: result.stats.updated,
                    skipped: result.stats.skipped,
                    failed: result.stats.failed,
                    report: result.report
                });
                
                loadDatabaseData();
                playSound('success');
                
            } catch (error) {
                console.error('Excelå¯¼å…¥å¤±è´¥:', error);
                
                showImportResult({
                    success: false,
                    error: error.message
                });
                
                playSound('error');
            } finally {
                importBtn.disabled = false;
                importBtn.innerHTML = '<i class="fas fa-upload"></i> å¼€å§‹å¯¼å…¥';
            }
        }
        
        // æ˜¾ç¤ºå¯¼å…¥ç»“æœ
        function showImportResult(result) {
            const progressDiv = document.getElementById('importProgress');
            const resultDiv = document.getElementById('importResult');
            const resultMessage = document.getElementById('resultMessage');
            
            progressDiv.style.display = 'none';
            resultDiv.style.display = 'block';
            
            if (result.success) {
                resultMessage.className = 'result-card result-success';
                resultMessage.innerHTML = `
                    <h5 style="margin-top:0; margin-bottom:15px;">
                        <i class="fas fa-check-circle"></i> Excelå¯¼å…¥æˆåŠŸï¼
                    </h5>
                    <p style="margin-bottom:15px;">æˆåŠŸå¤„ç† ${result.total || 0} æ¡è®°å½•</p>
                    
                    <div class="stats-grid-small">
                        <div class="stat-card-small">
                            <div class="stat-value-small" style="color:#28a745;">${result.created || 0}</div>
                            <div class="stat-label-small">æ–°å¢</div>
                        </div>
                        <div class="stat-card-small">
                            <div class="stat-value-small" style="color:#17a2b8;">${result.updated || 0}</div>
                            <div class="stat-label-small">æ›´æ–°</div>
                        </div>
                        <div class="stat-card-small">
                            <div class="stat-value-small" style="color:#ffc107;">${result.skipped || 0}</div>
                            <div class="stat-label-small">è·³è¿‡</div>
                        </div>
                        <div class="stat-card-small">
                            <div class="stat-value-small" style="color:#dc3545;">${result.failed || 0}</div>
                            <div class="stat-label-small">å¤±è´¥</div>
                        </div>
                    </div>
                    
                    ${result.report ? `
                        <div style="margin-top:15px; padding-top:15px; border-top:1px solid rgba(0,0,0,0.1);">
                            <div style="font-size:12px; color:#666;">
                                <div><i class="fas fa-clock"></i> è€—æ—¶: ${result.report.summary.è€—æ—¶ || 'N/A'}</div>
                                <div><i class="fas fa-file"></i> æ–‡ä»¶: ${result.report.summary['æ–‡ä»¶å¤§å°'] || 'N/A'}</div>
                            </div>
                        </div>
                    ` : ''}
                    
                    <button class="btn btn-primary" onclick="loadDatabaseData()" style="margin-top:15px; width:100%;">
                        <i class="fas fa-sync-alt"></i> åˆ·æ–°æ•°æ®æŸ¥çœ‹
                    </button>
                `;
            } else {
                resultMessage.className = 'result-card result-error';
                resultMessage.innerHTML = `
                    <h5 style="margin-top:0; margin-bottom:10px;">
                        <i class="fas fa-exclamation-circle"></i> Excelå¯¼å…¥å¤±è´¥
                    </h5>
                    <p>${result.error || 'æœªçŸ¥é”™è¯¯'}</p>
                    ${result.error && result.error.includes('Excel') ? 
                        '<p style="margin-top:10px; font-size:13px;"><i class="fas fa-lightbulb"></i> æç¤ºï¼šè¯·ç¡®ä¿æ–‡ä»¶æ ¼å¼æ­£ç¡®ï¼Œå¹¶åŒ…å«æ­£ç¡®çš„25åˆ—æ•°æ®</p>' : ''}
                `;
            }
        }
        
        // æ•°æ®æ¸…ç†åŠŸèƒ½
        async function startDataCleanup() {
            const cleanupDays = parseInt(document.getElementById('cleanupDays').value) || 7;
            const includeVideos = document.getElementById('includeVideos').checked;
            const cleanupBtn = document.getElementById('startCleanupBtn');
            const resultDiv = document.getElementById('cleanupResult');
            const resultMessage = document.getElementById('cleanupResultMessage');
            
            if (!confirm(`âš ï¸  ç¡®å®šè¦æ¸…ç†è¶…è¿‡ ${cleanupDays} å¤©çš„æ•°æ®å—ï¼Ÿ\n\næ­¤æ“ä½œä¸å¯æ’¤é”€ï¼`)) {
                return;
            }
            
            try {
                cleanupBtn.disabled = true;
                cleanupBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æ¸…ç†ä¸­...';
                
                if (!window.ReturnUnpackSystem || !window.ReturnUnpackSystem.modules.database) {
                    throw new Error('æ•°æ®åº“æ¨¡å—æœªåˆå§‹åŒ–');
                }
                
                const result = await window.ReturnUnpackSystem.modules.database.cleanupOldData(cleanupDays);
                
                resultDiv.style.display = 'block';
                resultMessage.innerHTML = `
                    <div style="background:#d4edda; color:#155724; padding:15px; border-radius:5px; border:1px solid #c3e6cb;">
                        <h5 style="margin-top:0;"><i class="fas fa-check-circle"></i> æ•°æ®æ¸…ç†å®Œæˆï¼</h5>
                        <p>æ¸…ç†ç»Ÿè®¡ï¼š</p>
                        <ul style="margin-bottom:0;">
                            <li>æ‰¾åˆ°è¶…è¿‡ ${cleanupDays} å¤©çš„è®°å½•: ${result.totalFound || 0} æ¡</li>
                            <li>æˆåŠŸåˆ é™¤è®¢å•è®°å½•: ${result.deletedCount || 0} æ¡</li>
                            ${includeVideos ? `<li>æˆåŠŸåˆ é™¤è§†é¢‘æ–‡ä»¶: ${result.videosDeleted || 0} ä¸ª</li>` : ''}
                        </ul>
                    </div>
                `;
                
                loadDatabaseData();
                showMessage('æ•°æ®æ¸…ç†å®Œæˆ', 'success');
                
            } catch (error) {
                console.error('æ•°æ®æ¸…ç†å¤±è´¥:', error);
                
                resultDiv.style.display = 'block';
                resultMessage.innerHTML = `
                    <div style="background:#f8d7da; color:#721c24; padding:15px; border-radius:5px; border:1px solid #f5c6cb;">
                        <h5 style="margin-top:0;"><i class="fas fa-exclamation-circle"></i> æ¸…ç†å¤±è´¥</h5>
                        <p>${error.message}</p>
                    </div>
                `;
                
                showMessage('æ¸…ç†å¤±è´¥: ' + error.message, 'error');
            } finally {
                cleanupBtn.disabled = false;
                cleanupBtn.innerHTML = '<i class="fas fa-broom"></i> å¼€å§‹æ¸…ç†';
            }
        }
        
        // å¤‡ä»½æ•°æ®åº“
        async function backupDatabase() {
            try {
                if (window.ReturnUnpackSystem && window.ReturnUnpackSystem.modules.database) {
                    await window.ReturnUnpackSystem.modules.database.createBackup();
                    document.getElementById('lastBackupTime').textContent = new Date().toLocaleString('zh-CN');
                    showMessage('æ•°æ®åº“å¤‡ä»½åˆ›å»ºæˆåŠŸ', 'success');
                } else {
                    showMessage('æ•°æ®åº“æ¨¡å—æœªåŠ è½½', 'error');
                }
            } catch (error) {
                console.error('å¤‡ä»½æ•°æ®åº“å¤±è´¥:', error);
                showMessage('å¤‡ä»½å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // æ¢å¤å¤‡ä»½
        function restoreDatabase() {
            showMessage('æ•°æ®åº“æ¢å¤åŠŸèƒ½å¼€å‘ä¸­...', 'info');
        }
        
        // åº”ç”¨æ•°æ®åº“ç­›é€‰
        function applyDatabaseFilter() {
            const dateFrom = document.getElementById('filterDateFrom').value;
            const dateTo = document.getElementById('filterDateTo').value;
            const status = document.getElementById('filterStatus').value;
            const damage = document.getElementById('filterDamage').value;
            
            showMessage(`åº”ç”¨ç­›é€‰: ${status || 'å…¨éƒ¨'} | ${damage || 'å…¨éƒ¨'} | ${dateFrom || 'ä¸é™'} è‡³ ${dateTo || 'ä¸é™'}`, 'info');
        }
        
        // é‡ç½®æ•°æ®åº“ç­›é€‰
        function resetDatabaseFilter() {
            document.getElementById('filterDateFrom').value = '';
            document.getElementById('filterDateTo').value = '';
            document.getElementById('filterStatus').value = '';
            document.getElementById('filterDamage').value = '';
            
            loadDatabaseData();
            showMessage('ç­›é€‰æ¡ä»¶å·²é‡ç½®', 'info');
        }
        
        // æ›´æ–°æ•°æ®åº“è¡¨æ ¼
        function updateDatabaseTable(data) {
            const tbody = document.getElementById('databaseTableBody');
            
            if (!data || data.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align:center;padding:40px;">
                            <i class="fas fa-database" style="font-size:48px;color:#ddd;margin-bottom:10px;"></i>
                            <p>æš‚æ— æ•°æ®</p>
                            <p style="color:#999;font-size:14px;margin-top:10px;">ç‚¹å‡»ä¸‹æ–¹"å¯¼å…¥Excelæ•°æ®"æŒ‰é’®å¯¼å…¥æ•°æ®</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            data.forEach((record, index) => {
                const statusClass = getStatusClass(record.status);
                const damageClass = getDamageClass(record.damage);
                
                html += `
                    <tr>
                        <td><input type="checkbox" class="record-checkbox" data-id="${record.id}"></td>
                        <td><strong>${record.orderNumber}</strong></td>
                        <td>${record.shopName || ''}</td>
                        <td>${record.scanTime}</td>
                        <td><span class="${statusClass}">${record.status}</span></td>
                        <td><span class="${damageClass}">${record.damage}</span></td>
                        <td>${record.videoFile ? 
                            `<a href="#" style="color:#4a6ee0;"><i class="fas fa-video"></i> ${record.videoFile}</a>` : 
                            '<span style="color:#999;">æ— </span>'}</td>
                        <td>${record.notes || ''}</td>
                        <td>
                            <button class="btn btn-sm" onclick="editRecord('${record.id}')" style="padding:4px 8px; font-size:12px; background:#17a2b8; color:white; margin-right:5px;">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm" onclick="deleteRecord('${record.id}')" style="padding:4px 8px; font-size:12px; background:#dc3545; color:white;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }
        
        // æ›´æ–°æ•°æ®åº“ç»Ÿè®¡
        function updateDatabaseStats(data) {
            const total = data.length;
            const damaged = data.filter(item => item.damage === 'ç ´æŸ' || item.damage === 'ç¼ºä»¶').length;
            const pending = data.filter(item => item.status === 'å¾…å¤„ç†').length;
            const processed = data.filter(item => item.status === 'å·²å¤„ç†').length;
            
            document.getElementById('totalRecords').textContent = total;
            document.getElementById('damagedRecords').textContent = damaged;
            document.getElementById('pendingRecords').textContent = pending;
            document.getElementById('processedRecords').textContent = processed;
        }
        
        // ç¼–è¾‘è®°å½•
        function editRecord(id) {
            showMessage(`ç¼–è¾‘è®°å½• ID: ${id}`, 'info');
        }
        
        // åˆ é™¤è®°å½•
        async function deleteRecord(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
                try {
                    if (window.ReturnUnpackSystem && window.ReturnUnpackSystem.modules.database) {
                        await window.ReturnUnpackSystem.modules.database.deleteOrder(id);
                        showMessage(`åˆ é™¤è®°å½•: ${id}`, 'success');
                        loadDatabaseData();
                    } else {
                        showMessage('æ•°æ®åº“æ¨¡å—æœªåŠ è½½', 'error');
                    }
                } catch (error) {
                    console.error('åˆ é™¤è®°å½•å¤±è´¥:', error);
                    showMessage('åˆ é™¤å¤±è´¥: ' + error.message, 'error');
                }
            }
        }
        
        // æ›´æ–°ä»Šæ—¥ç»Ÿè®¡
        async function updateTodayStats() {
            try {
                if (window.ReturnUnpackSystem && window.ReturnUnpackSystem.modules.database) {
                    const stats = await window.ReturnUnpackSystem.modules.database.getStatistics();
                    
                    document.getElementById('todayTotal').textContent = stats.todayTotal || 0;
                    document.getElementById('todayProcessed').textContent = stats.todayProcessed || 0;
                    document.getElementById('todayDamaged').textContent = stats.todayDamaged || 0;
                    document.getElementById('todayVideos').textContent = stats.todayVideos || 0;
                }
            } catch (error) {
                console.error('æ›´æ–°ç»Ÿè®¡å¤±è´¥:', error);
            }
        }
        
        // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®ï¼ˆæµ‹è¯•ç”¨ï¼‰
        function generateMockData(count) {
            const mockData = [];
            const statuses = ['å¾…å¤„ç†', 'å·²å¤„ç†', 'å·²é€€å›'];
            const damages = ['å®Œå¥½', 'ç ´æŸ', 'ç¼ºä»¶', 'å…¶ä»–'];
            const shopNames = ['æ——èˆ°åº—', 'ä¸“å–åº—', 'ç›´è¥åº—', 'ä»£ç†åº—'];
            
            for (let i = 1; i <= count; i++) {
                const date = new Date();
                date.setDate(date.getDate() - Math.floor(Math.random() * 30));
                
                mockData.push({
                    id: i,
                    orderNumber: `TH${date.getFullYear()}${String(date.getMonth() + 1).padStart(2, '0')}${String(date.getDate()).padStart(2, '0')}${String(i).padStart(3, '0')}`,
                    shopName: `${shopNames[Math.floor(Math.random() * shopNames.length)]}${Math.floor(Math.random() * 100)}`,
                    scanTime: date.toLocaleString('zh-CN'),
                    status: statuses[Math.floor(Math.random() * statuses.length)],
                    damage: damages[Math.floor(Math.random() * damages.length)],
                    videoFile: Math.random() > 0.3 ? `video_${i}.mp4` : null,
                    notes: Math.random() > 0.5 ? `å¤‡æ³¨å†…å®¹ ${i}` : '',
                    skuInfo: Math.random() > 0.5 ? `SKU${Math.floor(Math.random() * 1000)}-${Math.floor(Math.random() * 100)}` : ''
                });
            }
            
            return mockData;
        }
        
        // æ’­æ”¾éŸ³æ•ˆ
        function playSound(type) {
            try {
                const audio = document.getElementById(type + 'Sound');
                if (audio) {
                    audio.currentTime = 0;
                    audio.play().catch(e => console.log('éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', e));
                }
            } catch (error) {
                console.log('éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', error);
            }
        }
        
        // æ˜¾ç¤ºæ¶ˆæ¯é€šçŸ¥
        function showMessage(message, type = 'info') {
            console.log(`${type}: ${message}`);
            
            const statusText = document.getElementById('statusText');
            if (statusText) {
                statusText.textContent = message;
                
                const indicator = document.querySelector('.status-indicator');
                if (indicator) {
                    if (type === 'success') {
                        indicator.style.backgroundColor = '#4cd964';
                    } else if (type === 'error') {
                        indicator.style.backgroundColor = '#ff4757';
                    } else if (type === 'warning') {
                        indicator.style.backgroundColor = '#ffa502';
                    } else {
                        indicator.style.backgroundColor = '#4a6ee0';
                    }
                }
            }
            
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // è¾…åŠ©å‡½æ•°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function getStatusClass(status) {
            switch(status) {
                case 'å¾…å¤„ç†': return 'status-pending';
                case 'å·²å¤„ç†': return 'status-processed';
                case 'å·²é€€å›': return 'status-returned';
                default: return '';
            }
        }
        
        function getDamageClass(damage) {
            switch(damage) {
                case 'å®Œå¥½': return 'tag tag-good';
                case 'ç ´æŸ': return 'tag tag-damage';
                case 'ç¼ºä»¶': return 'tag tag-missing';
                case 'å…¶ä»–': return 'tag tag-other';
                default: return '';
            }
        }
    </script>
</body>
</html>